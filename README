# Datingnode Ansible


// deploy to staging
./datingnode image-build-inc
./datingnode image-build-all
// update data/clusters/staging to correct tag
./datingnode image-push-all
./datingnode staging-restart


// update the whitelist and deploy
./datingnode live-restart


// setup search path:
ALTER ROLE jimmy SET search_path TO "$user",public,gis;

## Docker setup

### Preparation

Install docker, instructions at https://docs.docker.com/installation/ubuntulinux/.

Also install docker registry, we'll just run in dev mode for now, in production we'll need something more robust:

    git clone git@github.com:dotcloud/docker-registry.git
    cd docker-registry
    docker --tag docker-registry .
    docker run --publish 5000:5000 --detach docker-registry

We also want apt-cacher-ng, so that we don't go mad waiting for it to download the same packages again and again from the same repositories:

    sudo apt-get install apt-cacher-ng

### Build the images

There's an ansible task to build all of the images in one go:

    ansible-playbook -c local -i localhost tasks/build-all-images.yml
