set -e

REMOVE_PACKAGES=(
)

INSTALL_PACKAGES=(
	"python-dev"
	"python-pip"
)

PYTHON_PACKAGES=(
	"paramiko"
	"PyYAML"
	"jinja2"
	"httplib2"
)

if test -f /etc/ansible-flag; then

	echo "=== skipping first time setup for ansible" >&2
	echo "remove /etc/ansible-flag to run this again" >&2

else

	export DEBIAN_FRONTEND=noninteractive

	echo "=== running first time setup for ansible" >&2

	echo "set grub-pc/install_devices /dev/sda" | debconf-communicate

	apt-get update -qqy

	apt-get purge -qqy "${REMOVE_PACKAGES[@]}"

	apt-get dist-upgrade -qqy

	apt-get install -qqy "${INSTALL_PACKAGES[@]}"

	pip install "${PYTHON_PACKAGES[@]}"

	touch /etc/ansible-flag

fi

echo "=== running ansible" >&2

cd /vagrant

source ansible/hacking/env-setup >/dev/null

ansible-playbook -i vagrant-local-inventory vagrant-local-task.yml

# ex: noet ts=4 filetype=sh
