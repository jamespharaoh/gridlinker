#!/bin/bash

# always run from vagrant machine

if ! test "$HOSTNAME" = "wistla-dev"; then
	vagrant up
	exec vagrant ssh --command "./run-ansible"
fi

# always run as root

if test "$UID" != "0"; then
	exec sudo "$0" "$@"
fi

# load ansible environment

cd /vagrant

source ansible/hacking/env-setup >/dev/null

# run ansible-playbook

exec ansible-playbook \
	--inventory-file inventory \
	--extra-vars @config \
	site.yml \
	"${@}"
