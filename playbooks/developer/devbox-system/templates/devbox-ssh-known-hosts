{%- print ansible_warning ['#'], '\n' -%}

{%- print '\n' -%}

{%- for name, lines in ssh_host_keys.general.items () -%}

	{%- print [
		name,
		lines | join,
	] | join (' '), '\n' -%}

{%- endfor -%}

{%- print '\n' -%}

{%- for other_deployment_name in dev_deployment_names
	if other_deployment_name in ssh_host_keys.dev -%}

	{%- set other_deployment = deployments [other_deployment_name] -%}

	{%- print [
		[
			'wistla-' + other_deployment_name + '-dev',
			other_deployment.bridge_network + '.0.1',
		] | join (','),
		ssh_host_keys.dev [other_deployment_name] | join,
	] | join (' '), '\n' -%}

{%- endfor -%}

{%- print '\n' -%}

{%- for host_name in groups ['cluster-host'] -%}

	{%- set host = hostvars [host_name] -%}
	{%- set instance_cluster_name = host.cluster_name -%}
	{%- set instance_type = host.instance_type -%}
	{%- set instance_zone = host.instance_zone -%}
	{%- set instance_index = host.instance_index | string -%}

	{%- set instance_cluster = clusters [instance_cluster_name] -%}

	{%- if instance_cluster_name in ssh_host_keys -%}
	{%- if instance_type in ssh_host_keys [instance_cluster_name] -%}

		{%- if instance_zone + '-' + instance_index in ssh_host_keys [instance_cluster_name] [instance_type] -%}
			{%- set ssh_host_key = ssh_host_keys [instance_cluster_name] [instance_type] [instance_zone + '-' + instance_index] | join -%}
		{%- elif instance_zone in ssh_host_keys [instance_cluster_name] [instance_type] -%}
			{%- set ssh_host_key = ssh_host_keys [instance_cluster_name] [instance_type] [instance_zone] | join -%}
		{%- else -%}
			{%- set ssh_host_key = None -%}
		{%- endif -%}

		{%- if ssh_host_key and instance_type == 'admin' -%}

			{%- print [
				[
					host_name,
					host_name + '.' + instance_cluster.main_domain,
					instance_zone + '.admin.' + instance_cluster.main_domain,
					host.private_address,
				] | join (','),
				ssh_host_key,
			] | join (' ') + '\n' -%}

		{%- elif ssh_host_key -%}

			{%- print [
				[
					host_name,
					host_name + '.' + instance_cluster.main_domain,
					host.private_address,
				] | join (','),
				ssh_host_key,
			] | join (' ') + '\n' -%}

		{%- else -%}

			{%- print '# ' + host_name + ' (no host key)\n' -%}

		{%- endif -%}

	{%- endif -%}
	{%- endif -%}

{%- endfor %}

{%- for ssh_host_key_extra in ssh_host_keys_extra | default ([]) -%}

	{%- print ssh_host_key_extra, '\n' -%}

{%- endfor -%}
