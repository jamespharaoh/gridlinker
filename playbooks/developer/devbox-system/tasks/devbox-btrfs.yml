---

- name: "create btrfs disk"
  action: shell
    truncate --size 32GiB /btrfs-image
  args:
    creates: "/btrfs-image"
  sudo: "yes"
  sudo_user: "root"

- name: "create btrfs file system"
  action: shell
    mkfs.btrfs /btrfs-image
    && touch /etc/btrfs-flag
  args:
    creates: "/etc/btrfs-flag"
  sudo: "yes"
  sudo_user: "root"

- name: "create fstab"
  action:
    module: "template"
    src: "devbox-fstab"
    dest: "/etc/fstab"
  sudo: "yes"
  sudo_user: "root"

- name: "mount all filesystems"
  action: shell
    mount -a
  sudo: "yes"
  sudo_user: "root"
  register: "mount_result"
  changed_when: "mount_result.stdout != ''"

# ex: et ts=2 filetype=yaml
