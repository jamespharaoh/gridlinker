---

- name: "install openvpn ca cert"
  action:

    module: "copy"
    dest: "/etc/openvpn/wistla-ca.cert"
    src: "{{ HOME }}/security/wistla-ca.cert"

- name: "install openvpn client cert"
  with_items: "{{ vpns }}"
  notify: "restart openvpn"
  sudo: "yes"
  action:

    module: "copy"
    dest: "/etc/openvpn/wistla-{{ item }}-vpn.cert"
    src: "{{ HOME }}/security/vpn/{{ item }}.cert"

- name: "install openvpn client key"
  with_items: "{{ vpns }}"
  notify: "restart openvpn"
  sudo: "yes"
  action:

    module: "copy"
    dest: "/etc/openvpn/wistla-{{ item }}-vpn.key"
    src: "{{ HOME }}/security/vpn/{{ item }}.key"
    mode: "0600"

- name: "create openvpn config"
  with_items: "{{ vpns }}"
  notify: "restart openvpn"
  sudo: "yes"
  action:

    module: "template"
    dest: "/etc/openvpn/wistla-{{ item }}-vpn.conf"
    src: "devbox-openvpn-config"

# ex: et ts=2 filetype=yaml
