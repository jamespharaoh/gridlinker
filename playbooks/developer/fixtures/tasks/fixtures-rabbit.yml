---

- name: "enable rabbit management plugin"
  shell: "{{ [
    deployment_name + '-rabbit-0',
    'sudo',
    'rabbitmq-plugins',
    'enable',
    'rabbitmq_management',
  ] | join (' ') }}"

- name: "create rabbit api user"
  ignore_errors: yes
  shell: "{{ [
    deployment_name + '-rabbit-0',
    'sudo',
    'rabbitmqctl',
    'add_user',
    'api',
    third_parties.dev.rabbit_api_password,
  ] | join (' ') }}"

- name: "set rabbit api user tags"
  shell: "{{ [
    deployment_name + '-rabbit-0',
    'sudo',
    'rabbitmqctl',
    'set_user_tags',
    'api',
    'management',
  ] | join (' ') }}"

- name: "set rabbit api user permissions"
  shell: "{{ [
    deployment_name + '-rabbit-0',
    'sudo',
    'rabbitmqctl',
    'set_permissions',
    'api',
    '.\\*',
    '.\\*',
    '.\\*',
  ] | join (' ') }}"

# ex: et ts=2 filetype=yaml
