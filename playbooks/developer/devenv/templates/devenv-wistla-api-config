{{ ansible_warning ['//'] }}

var ROOT = process.cwd ();
var config = require(ROOT + '/config/config.global');

// public urls
config.adminUrl = 'https://{{ deployment.admin_domain }}';
config.apiUrl = 'https://{{ deployment.api_domain }}';
config.assetsUrl = 'https://{{ deployment.assets_domain }}';
config.shortUrl = 'https://{{ deployment.short_domain }}';
config.webUrl = 'https://{{ deployment.web_domain }}';

// test urls
config.adminTest = 'http://{{ deployment.admin_domain }}';
config.apiTest = 'http://{{ deployment.api_domain }}';
config.assetsTest = 'http://{{ deployment.assets_domain }}';
config.shortTest = 'http://{{ deployment.short_domain }}';
config.webTest = 'http://{{ deployment.web_domain }}';

// Database.
config.dbUrl = 'mongodb://{{ deployment_name }}-mongo-0:27017/wistla';

// message exchange
config.amqpOptions = {
	url: 'amqp://{{ deployment_name }}-rabbit-0',
};

// CORS
config.CORS = {
	origins: [

		// public urls
		config.adminUrl,
		config.apiUrl,
		config.assetsUrl,
		config.shortUrl,
		config.webUrl,

		// test urls
		config.adminTest,
		config.apiTest,
		config.assetsTest,
		config.shortTest,
		config.webTest,

	],
	credentials: true
};

{% if use_s3 == 'yes' %}

// amazon s3 blob storage
config.blobMode = 'amazon';
config.blobAmazon = {
	accessKey: '{{ amazon_accounts.test.access_key }}',
	secretKey: '{{ amazon_accounts.test.secret_key }}',
	bucketName: 'wistla-dev',
	bucketPrefix: '/{{ deployment_name }}/blobs'
};

{% else %}

// local blob storage
config.blobMode = 'local';

{% endif %}

// mailchimp
{% if 'dev' in third_parties %}
config.mailchimp = {
	listId: '{{ third_parties.dev.mailchimp_unique_id }}',
	apiKey: '{{ third_parties.dev.mailchimp_api_key }}',
};
{% else %}
config.mailchimp = {
	listId: '',
	apiKey: '',
};
{% endif %}

// test data loader
config.loadingData = {
	email: '350477707572-gcc5pqssbhl7n29pbcs923havgbddh1e@developer.gserviceaccount.com',
	keyFile: ROOT + '/config/google-service-account.key',
{% if 'dev' in third_parties %}
        cryptoKey: '{{ third_parties.dev.google_maps_key }}'
{% else %}
		cryptoKey: ''
{% endif %}
};

// apple push notifications
config.applePush = {
{% if dev_apple_push_notifications_enabled | default ('no') == 'yes' %}
	enabled: true,
	caCertFile: ROOT + '/config/apple-ca.cert',
	certFile: ROOT + '/config/apple-push.cert',
	keyFile: ROOT + '/config/apple-push.key',
	production: {{ 'true' if dev_apple_push_notifications_production == 'yes' else 'false' }},
{% else %}
	enabled: false,
{% endif %}
};

module.exports = config;

// ex: noet ts=4 filetype=javascript
