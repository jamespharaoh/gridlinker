---

- name: "start lxc container"
  register: start_result
  changed_when: start_result.stdout != 'UNCHANGED'
  delegate_to: "localhost"
  args:

    executable: "/bin/bash"

  become: "yes"
  shell:

    set -euf -o pipefail;

    state=$(
      lxc-info
        --name {{ inventory_hostname }}
        --state
        --no-humanize
      | head --lines 1
    );

    if test "$state" = "RUNNING"; then
      echo "UNCHANGED";
      return;
    fi;

    lxc-start
      --name {{ inventory_hostname }}
      --daemon;

- name: "create container shortcut"
  delegate_to: "localhost"
  become: "yes"
  action:

    module: "template"
    dest: "/usr/local/bin/{{ inventory_hostname }}"
    src: "lxc-shortcut"

    mode: "0755"

# ex: et ts=2 filetype=yaml
