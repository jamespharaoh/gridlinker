---

- name: "stop lxc container"
  delegate_to: "localhost"
  shell:

    if ! test -d /var/lib/lxc/{{ inventory_hostname }}; then
      echo "UNCHANGED";
      return;
    fi;

    state=$(
      lxc-info
        --name {{ inventory_hostname }}
        --state
        --no-humanize
      | head --lines 1
    );

    if test "$state" != "RUNNING"; then
      echo "UNCHANGED";
      return;
    fi;

    lxc-stop
      --name {{ inventory_hostname }}
      --timeout 10;

  delegate_to: "localhost"
  sudo: "yes"
  sudo_user: "root"
  register: stop_result
  changed_when: stop_result.stdout != 'UNCHANGED'

- name: "remove container shortcut"
  delegate_to: "localhost"
  sudo: "yes"
  action:

    module: "file"
    path: "/usr/local/bin/{{ inventory_hostname }}"
    state: "absent"

# ex: et ts=2 filetype=yaml
