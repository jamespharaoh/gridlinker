---

- name: "write vm fstab"
  action:
    module: "template"
    src: "datingnode-vm-fstab"
    dest: "/etc/fstab"
  sudo: "yes"

- name: "install database backup script"
  action:
    module: "copy"
    dest: "/usr/local/bin/database-backup-script"
    src: "datingnode-vm-database-backup-script"
    mode: "0755"
  sudo: "yes"

- name: "install database backup config"
  action:
    module: "template"
    dest: "/etc/database-backup-config"
    src: "datingnode-vm-database-backup-config"
    mode: "0600"
  sudo: "yes"

- name: "configure cron"
  action:
    module: "template"
    src: "datingnode-vm-cron"
    dest: "/etc/cron.d/datingnode"
  sudo: "yes"
  notify: "restart cron"

- meta: "flush_handlers"

- name: "upload ssls"
  connection: "local"
  shell:
    rsync \
      --archive \
      /datingnode-ssl/ \
      root@{{ public_address }}:/datingnode-ssl/
  sudo: "yes"

# ex: et ts=2 filetype=yaml
