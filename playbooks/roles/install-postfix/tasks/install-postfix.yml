---

- name: "install postfix packages"
  with_items:

    - "mailutils"
    - "postfix"

  sudo: "yes"
  action:

    module: "apt"
    name: "{{ item }}"

- name: "configure postfix"
  with_items:

    - target: "/etc/postfix/main.cf"
      template: "install-postfix-main"
      user: "root"
      group: "root"
      mode: "0644"

    - target: "/etc/postfix/sasl-passwords"
      template: "postfix-sasl-passwords"
      user: "root"
      group: "root"
      mode: "0600"

    - target: "/etc/postfix/transport"
      template: "postfix-transport"
      user: "root"
      group: "root"
      mode: "0600"

  notify: "restart postfix"
  sudo: "yes"
  action:

    module: "template"
    dest: "{{ item.target }}"
    src: "{{ item.template }}"

    owner: "{{ item.user }}"
    group: "{{ item.group }}"
    mode: "{{ item.mode }}"

- name: "create postfix hashes"
  with_items:

    - "/etc/postfix/sasl-passwords"
    - "/etc/postfix/transport"

  sudo: "yes"
  shell: "postmap {{ item }}"

- meta: "flush_handlers"

# ex: et ts=2 filetype=yaml
