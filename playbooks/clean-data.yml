---

- hosts: "localhost"
  tasks:

    - name: "check deployment mode"
      when: "deployment_mode == 'alias'"
      fail:

        prompt: "not available in this deployment mode"

    - name: "warning"
      when: "deployment_mode == 'vagrant'"
      pause:

        prompt: "WARNING - this will delete all runtime data"

- include: "node-stop.yml"

- hosts: "localhost"
  tasks:

    - name: "remove shared directory"
      become: "yes"
      shell:

        rm -rf {{ deployment_home }}/shared/*;

    - name: "create shared directory"
      action:

        module: "file"
        path: "{{ deployment_home }}/shared"
        state: "directory"

    - name: "clean out zookeeper"
      when: "deployment_mode in [ 'vagrant', 'jenkins' ]"
      args:

        executable: "/bin/bash"

      shell:

        set -euf -o pipefail;

        /usr/lib/zookeeper/bin/load_gen
          "localhost:2181"
          "/wistla-{{ deployment_name }}-dev/kafka"
          "clean"
        || true;

# ex: et ts=2 filetype=yaml
