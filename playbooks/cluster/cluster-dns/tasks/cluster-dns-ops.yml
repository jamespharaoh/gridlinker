---

- name: "create dev deployment records"
  action:

    module: "route53"
    record: "{{ item.0 [item.1] }}"
    command: "create"

    zone: "dev.wistla.com"
    overwrite: "yes"

    type: "A"
    ttl: "{{ ttl_medium }}"
    value: "{{ admin_balancer_hosted_zone_name }}"
    alias: "yes"
    alias_hosted_zone_id: "{{ admin_balancer_hosted_zone_name_id }}"

    aws_access_key: "{{ amazon_credentials [amazon_account_name].access_key }}"
    aws_secret_key: "{{ amazon_credentials [amazon_account_name].secret_key }}"
    security_token: "{{ amazon_credentials [amazon_account_name].session_token }}"

  when: "'.dev.wistla.com' in item.0 [item.1]"

  with_nested:

    - "{{ dev_deployment_names | default ([]) | dict_map (deployments) }}"

    - - "main_domain"
      - "admin_domain"
      - "api_domain"
      - "assets_domain"
      - "web_domain"

- name: "create short dev deployment records"
  action:

    module: "route53"
    record: "{{ item.short_domain }}"
    command: "create"

    zone: "dev.wist.la"
    overwrite: "yes"

    type: "A"
    ttl: "{{ ttl_medium }}"
    value: "{{ admin_balancer_hosted_zone_name }}"
    alias: "yes"
    alias_hosted_zone_id: "{{ admin_balancer_hosted_zone_name_id }}"

    aws_access_key: "{{ amazon_credentials [amazon_account_name].access_key }}"
    aws_secret_key: "{{ amazon_credentials [amazon_account_name].secret_key }}"
    security_token: "{{ amazon_credentials [amazon_account_name].session_token }}"

  when: "'.dev.wist.la' in item.short_domain"

  with_items: "{{
    dev_deployment_names | default ([]) | dict_map (deployments)
  }}"

- name: "create jenkins deployment record"
  action:

    module: "route53"
    record: "jenkins.ops.wistla.com"
    command: "create"

    zone: "ops.wistla.com"
    overwrite: "yes"

    type: "A"
    ttl: "{{ ttl_medium }}"
    value: "{{ admin_balancer_hosted_zone_name }}"
    alias: "yes"
    alias_hosted_zone_id: "{{ admin_balancer_hosted_zone_name_id }}"

    aws_access_key: "{{ amazon_credentials [amazon_account_name].access_key }}"
    aws_secret_key: "{{ amazon_credentials [amazon_account_name].secret_key }}"
    security_token: "{{ amazon_credentials [amazon_account_name].session_token }}"

# ex: et ts=2 filetype=yaml
