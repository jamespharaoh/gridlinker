---

- name: "create admin per-zone dns"
  delegate_to: "localhost"
  with_nested:

    - - "admin"
      - "vpn"

    - - "a"
      - "b"
      - "c"

  action:

    module: "route53"
    record: "{{ item.1 }}.{{ item.0 }}.{{ cluster.main_domain }}"
    command: "create"
    overwrite: "yes"

    zone: "{{ cluster.main_domain }}"
    ttl: "60"
    type: "A"
    value: "{{ cluster.amazon_admin_ips [item.1] }}"

    aws_access_key: "{{ amazon_credentials [amazon_account_name].access_key }}"
    aws_secret_key: "{{ amazon_credentials [amazon_account_name].secret_key }}"
    security_token: "{{ amazon_credentials [amazon_account_name].session_token }}"

- name: "create main misc records"
  with_items: "cluster.route53_main_domain.misc_records"
  action:

    module: "route53"
    record: "{{
      cluster.main_domain if item.name == '@'
      else item.name + '.' + cluster.main_domain
    }}"
    command: "create"
    overwrite: "yes"

    zone: "{{ cluster.main_domain }}"
    type: "{{ item.type }}"
    ttl: "{{ item.ttl }}"
    value: "{{ item.value }}"

    region: "{{ amazon_region_name }}"

    aws_access_key: "{{ amazon_credentials [amazon_account_name].access_key }}"
    aws_secret_key: "{{ amazon_credentials [amazon_account_name].secret_key }}"
    security_token: "{{ amazon_credentials [amazon_account_name].session_token }}"

# ex: et ts=2 filetype=yaml
