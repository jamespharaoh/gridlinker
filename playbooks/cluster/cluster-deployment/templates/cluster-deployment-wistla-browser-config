{{ ansible_warning ['//'] }}

var ROOT = process.env.HOME + '/wistla-browser';
var config = require(ROOT + '/config/config.global');

// Database.
config.dbUrl = 'mongodb://{{ cluster_deployment_alias.name }}-mongo-{{ instance_zone }}-{{ instance_index }}:27017/wistla-browser';

// public urls
config.adminUrl = 'https://{{ cluster_deployment_alias.admin_domain }}';
config.apiUrl = 'https://{{ cluster_deployment_alias.api_domain }}';
config.assetsUrl = 'https://{{ cluster_deployment_alias.assets_domain }}';
config.shortUrl = 'https://{{ cluster_deployment_alias.short_domain }}';
config.webUrl = 'https://{{ cluster_deployment_alias.web_domain }}';

// private urls
config.apiPrivate = 'http://{{ cluster_deployment_name }}-api-{{ instance_zone }}-{{ instance_index }}:7000';

// email
config.emailDomain = '{{ cluster_deployment.email_domain }}';

{% if cluster_deployment_alias ['name'] in [ 'test-k2', 'test-montblanc' ] %}

{% if cluster_deployment_alias ['name'] == 'test-k2' %}
// Deep link url scheme for use in sending out emails.
config.urlScheme = '{{ third_parties ['production'].url_scheme }}';

// Facebook AppId.
config.facebook.appId = '{{ third_parties ['production'].facebook_app_id }}';

{% endif %}

{% if cluster_deployment_alias ['name'] == 'test-montblanc' %}
// Deep link url scheme for use in sending out emails.
config.urlScheme = '{{ third_parties ['dev'].url_scheme }}';

// Facebook AppId.
config.facebook.appId = '{{ third_parties ['dev'].facebook_app_id }}';

{% endif %}

{% else %}

// Deep link url scheme for use in sending out emails.
config.urlScheme = '{{ third_parties [cluster_name].url_scheme }}';

// Facebook AppId.
config.facebook.appId = '{{ third_parties [cluster_name].facebook_app_id }}';

{% endif %}

if (!config.authentication || typeof config.authentication !== 'object') {
        config.authentication = {};
}
if (!config.authentication.google || typeof config.authentication.google !== 'object') {
        config.authentication.google = {};
}
{% if cluster_name in third_parties %}
config.authentication.google.name = '{{ third_parties[cluster_name].google_auth_name }}';
config.authentication.google.client_id = '{{ third_parties[cluster_name].google_auth_client_id }}';
config.authentication.google.client_secret = '{{ third_parties[cluster_name].google_auth_client_secret }}';
{% else %}
config.authentication.google.name = '';
config.authentication.google.client_id = '';
config.authentication.google.client_secret = '';
{% endif %}

module.exports = config;

// ex: noet ts=4 filetype=javascript
