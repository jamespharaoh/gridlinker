---

- name: "update system packages"
  sudo: "yes"
  args:

    executable: "/bin/bash"

  shell:

    set -euf -o pipefail;

    echo "---------- update package database";

    apt-get -y update;

    echo "---------- upgrade packages";

    apt-get -y dist-upgrade;

    echo "---------- remove automatically installed packages";

    apt-get -y autoremove;

    echo "---------- purge removed packages";

    dpkg --list
      | (set +e; grep "^rc"; test $? = 0 -o $? = 1)
      | cut -d " " -f 3
      | xargs --no-run-if-empty sudo dpkg --purge;

# ex: et ts=2 filetype=yaml
