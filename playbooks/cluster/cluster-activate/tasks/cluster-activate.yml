---

- name: "add instance to load balancer"
  when: "amazon_instance_state == 'running'"
  local_action:

    module: "ec2_elb"
    instance_id: "{{ instance_id }}"
    ec2_elbs: "{{ load_balancer_name }}"
    state: "present"

    region: "{{ amazon_region_name }}"

    aws_access_key: "{{ amazon_credentials [amazon_account_name].access_key }}"
    aws_secret_key: "{{ amazon_credentials [amazon_account_name].secret_key }}"
    security_token: "{{ amazon_credentials [amazon_account_name].session_token }}"

- name: "remove instance from load balancer"
  when: "amazon_instance_state != 'running'"
  local_action:

    module: "ec2_elb"
    instance_id: "{{ instance_id }}"
    ec2_elbs: "{{ load_balancer_name }}"
    state: "absent"

    region: "{{ amazon_region_name }}"

    aws_access_key: "{{ amazon_credentials [amazon_account_name].access_key }}"
    aws_secret_key: "{{ amazon_credentials [amazon_account_name].secret_key }}"
    security_token: "{{ amazon_credentials [amazon_account_name].session_token }}"

# ex: et ts=2 filetype=yaml
