---

- set_fact:

    subnet: "admin"

- name: "write admin subnet stack yaml"
  action:

    module: "template"
    src: "cluster-subnet-stack"
    dest: "/home/vagrant/work/{{ cluster_name }}/admin-subnet-stack.yaml"

- name: "create admin subnet stack"
  register: "admin_subnet_stack_result"
  action:

    module: "cloudformation"
    stack_name: "{{ cluster_name }}-subnet-admin"
    state: "present"

    template: "/home/vagrant/work/{{ cluster_name }}/admin-subnet-stack.yaml"
    template_format: "yaml"

    aws_access_key: "{{ amazon_account.access_key }}"
    aws_secret_key: "{{ amazon_account.secret_key }}"
    region: "{{ amazon_region_name }}"

- update_resource:

    routes_admin_a: "{{ admin_subnet_stack_result.stack_outputs.RouteTableA }}"
    routes_admin_b: "{{ admin_subnet_stack_result.stack_outputs.RouteTableB }}"
    routes_admin_c: "{{ admin_subnet_stack_result.stack_outputs.RouteTableC }}"
    subnet_admin_a: "{{ admin_subnet_stack_result.stack_outputs.SubnetA }}"
    subnet_admin_b: "{{ admin_subnet_stack_result.stack_outputs.SubnetB }}"
    subnet_admin_c: "{{ admin_subnet_stack_result.stack_outputs.SubnetC }}"

# ex: et ts=2 filetype=yaml
