---

#- name: "install icinga web packages"
#  action:
#    module: "apt"
#    package: "{{ item }}"
#  sudo: "yes"
#  with_items:
#    - "icinga2-classicui"

- name: "create icinga cgi dirs"
  action:
    module: "file"
    path: "{{ item.path }}"
    state: "directory"
    owner: "{{ item.owner | default ('root') }}"
    group: "{{ item.group | default ('root') }}"
    mode: "{{ item.mode | default ('0755') }}"
  sudo: "yes"
  with_items:

    - path: "/opt/icinga/var/log"
      owner: "www-data"
      group: "adm"
      mode: "0750"

    - path: "/opt/icinga2/etc/icinga2-classicui"

- name: "install icinga cgi config"
  action:
    module: "template"
    src: "{{ item.template }}"
    dest: "{{ item.target }}"
    owner: "{{ item.owner | default ('root') }}"
    group: "{{ item.group | default ('root') }}"
    mode: "{{ item.mode | default ('0644') }}"
  sudo: "yes"
  with_items:

    - template: "icinga-classicui-cgi"
      target: "/opt/icinga2/etc/icinga2-classicui/cgi.cfg"

    - template: "icinga-htpasswd"
      target: "/opt/icinga2/etc/icinga2-classicui/htpasswd.users"
      owner: "root"
      group: "www-data"
      mode: "0640"

# ex: et ts=2 filetype=yaml
