---

- include_vars: "security/icinga/icinga-secrets"

#- name: "add icinga ppa"
#  action:
#    module: "apt_repository"
#    repo: "ppa:formorer/icinga"
#    update_cache: "yes"
#  sudo: "yes"

#- name: "install icinga packages"
#  action:
#    module: "apt"
#    package: "{{ item }}"
#  sudo: "yes"
#  with_items:
#    - "icinga2"

- name: "remove icinga packages"
  action:
    module: "apt"
    package: "{{ item }}"
    state: "absent"
    purge: "yes"
  sudo: "yes"
  with_items:
    - "icinga2"
    - "icinga2-bin"
    - "icinga2-classicui"
    - "icinga2-common"
    - "icinga2-doc"

- name: "install icinga dependencies"
  action:
    module: "apt"
    package: "{{ item }}"
    purge: "yes"
  sudo: "yes"
  with_items:
    - "libboost-program-options1.54.0"
    - "libboost-regex1.54.0"
    - "libyajl2"
    - "nagios-plugins"

- name: "create icinga user"
  action:
    module: "user"
    name: "icinga"
    uid: "1001"
  sudo: "yes"

- name: "create directories"
  action:
    module: "file"
    path: "{{ item }}"
    state: "directory"
    owner: "icinga"
    group: "icinga"
  sudo: "yes"
  with_items:
    - "/opt/icinga2/var/cache/icinga2"
    - "/opt/icinga2/var/lib/icinga2"
    - "/opt/icinga2/var/lib/icinga2/api"
    - "/opt/icinga2/var/lib/icinga2/api/log"
    - "/opt/icinga2/var/lib/icinga2/api/repository"
    - "/opt/icinga2/var/lib/icinga2/api/zones"
    - "/opt/icinga2/var/log/icinga2"
    - "/opt/icinga2/var/log/icinga2/compat"
    - "/opt/icinga2/var/log/icinga2/crash"
    - "/opt/icinga2/var/run/icinga2"
    - "/opt/icinga2/var/run/icinga2/cmd"

# ex: et ts=2 filetype=yaml
