---

- name: "create jenkins service config"
  action:
    module: "template"
    src: "cluster-jenkins-default"
    dest: "/etc/default/jenkins"
  sudo: "yes"
  notify: "restart jenkins"

- name: "install jenkins apt key"
  action:
    module: "apt_key"
    url: "https://jenkins-ci.org/debian/jenkins-ci.org.key"
  sudo: "yes"

- name: "install jenkins apt repository"
  action:
    module: "apt_repository"
    repo: "deb http://pkg.jenkins-ci.org/debian binary/"
    update_cache: "yes"
  sudo: "yes"

- name: "install jenkins packages"
  action:
    module: "apt"
    package: "{{ item }}"
  sudo: "yes"
  with_items:
    - "jenkins"

- name: "enable jenkins sudo"
  action:
    module: "copy"
    dest: "/etc/sudoers.d/jenkins"
    content: "jenkins ALL=(ALL) NOPASSWD: ALL{{ '\n' }}"
  sudo: "yes"

- meta: "flush_handlers"

# ex: et ts=2 filetype=yaml
