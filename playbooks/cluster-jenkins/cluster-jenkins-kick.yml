---

- hosts: "cluster-jenkins"
  tasks:

    - name: "cluster jenkins kick stop"
      delegate_to: "localhost"
      action:

        module: "ec2"
        instance_ids: "{{ instance_id }}"
        state: "stopped"

        region: "{{ amazon_region_name }}"
        wait: "no"

        aws_access_key: "{{
          amazon_credentials [amazon_account_name].access_key
        }}"

        aws_secret_key: "{{
          amazon_credentials [amazon_account_name].secret_key
        }}"

        security_token: "{{
          amazon_credentials [amazon_account_name].session_token
        }}"

    - name: "cluster jenkins pause 5 seconds"
      delegate_to: "localhost"
      action:

        module: "pause"
        seconds: "5"

    - name: "cluster jenkins kick force stop"
      delegate_to: "localhost"
      action:

        module: "ec2"
        instance_ids: "{{ instance_id }}"
        state: "stopped"

        region: "{{ amazon_region_name }}"
        wait: "yes"

        aws_access_key: "{{
          amazon_credentials [amazon_account_name].access_key
        }}"

        aws_secret_key: "{{
          amazon_credentials [amazon_account_name].secret_key
        }}"

        security_token: "{{
          amazon_credentials [amazon_account_name].session_token
        }}"

    - name: "cluster jenkins pause 5 seconds"
      delegate_to: "localhost"
      action:

        module: "pause"
        seconds: "5"

- hosts: "cluster-jenkins"
  roles:

    - "cluster-create"

# ex: et ts=2 filetype=yaml
