---

- name: "create jenkins service config"
  notify: "restart jenkins"
  sudo: "yes"
  action:

    module: "template"
    dest: "/etc/default/jenkins"
    src: "cluster-jenkins-default"

- name: "install jenkins apt key"
  sudo: "yes"
  action:

    module: "apt_key"
    url: "https://jenkins-ci.org/debian/jenkins-ci.org.key"

- name: "install jenkins apt repository"
  sudo: "yes"
  action:

    module: "apt_repository"
    repo: "deb http://pkg.jenkins-ci.org/debian binary/"
    update_cache: "yes"

- name: "install jenkins packages"
  with_items:

    - "jenkins"

  sudo: "yes"
  action:

    module: "apt"
    name: "{{ item }}"

- name: "enable jenkins sudo"
  sudo: "yes"
  action:

    module: "copy"
    dest: "/etc/sudoers.d/jenkins"
    content: "jenkins ALL=(ALL) NOPASSWD: ALL{{ '\n' }}"

- meta: "flush_handlers"

# ex: et ts=2 filetype=yaml
