---

- hosts: "cluster-host"
  tasks:

    - name: "verify action for production instance"
      when: "
        cluster_name == 'production'
        and cluster_production_override | default ('') != inventory_hostname
      "
      fail:
        msg: "please set cluster_production_override"

- hosts: "cluster-host"
  tasks:

    - name: "set amazon_instance_state to 'standby'"
      when: "amazon_instance_state != 'standby'"
      update_resource:

        amazon_instance_state: "standby"

- hosts: "cluster-host"
  roles:

    - "cluster-app-lxc"
    - "cluster-activate"

- hosts: "cluster-app"
  roles:

    - "cluster-create"
    - "wait-for-ssh"

- hosts: "cluster-app"
  roles:

    - "cluster-app-lxc"
    - "cluster-activate"

# ex: et ts=2 filetype=yaml
