---

- name: "install io.js"
  args:
    executable: "/bin/bash"
    creates: "{{ iojs_flag }}"
  sudo: "yes"
  shell:

    set -euf -o pipefail;

    rm -rf {{ iojs_tmp }};
    mkdir {{ iojs_tmp }};
    cd {{ iojs_tmp }};

    wget {{ iojs_url }};

    rm -rf {{ iojs_name }};
    tar --extract --xz --file {{ iojs_archive }};

    rsync --archive --delete {{ iojs_name }}/ {{ iojs_target }}/;

    rm -rf {{ iojs_tmp }};
    touch {{ iojs_flag }};

- name: "setup iojs alternatives"
  action:
    module: "alternatives"
    name: "{{ item.name }}"
    link: "{{ item.link }}"
    path: "{{ item.target }}"
    force: "yes"
  sudo: "yes"
  with_items: "iojs_alternatives"
  when: "iojs_default == 'yes'"

# ex: et ts=2 filetype=yaml
