---

- name: "remove postfix"
  action:
    module: "apt"
    name: "{{ item }}"
    state: "absent"
    purge: "yes"
  sudo: "yes"
  with_items:
    - "postfix"

- name: "configure nullmailer"
  action:
    module: "debconf"
    name: "nullmailer"
    question: "{{ item.question }}"
    value: "{{ item.value }}"
    vtype: "{{ item.type }}"
  sudo: "yes"
  with_items:

    - question: "nullmailer/relayhost"
      value: "10.255.255.10"
      type: "string"

    - question: "nullmailer/defaultdomain"
      value: "{{ deployment.email_domain }}"
      type: "string"

    - question: "nullmailer/adminaddr"
      value: ""
      type: "string"

# TODO mailname needs to be configured later

- name: "configure mailname"
  sudo: "yes"
  action:

    module: "copy"
    dest: "/etc/mailname"
    content: "{{ deployment.email_domain + '\n' }}"

- name: "install nullmailer"
  with_items:

    - "nullmailer"

  sudo: "yes"
  action:

    module: "apt"
    name: "{{ item }}"

# ex: et ts=2 filetype=yaml
