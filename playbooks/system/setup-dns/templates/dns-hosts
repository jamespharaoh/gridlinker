{%- print ansible_warning ['#'] + '\n' -%}

{%- if inventory_hostname in groups.vagrant -%}

	{%- print '\n', [
		deployment.bridge_network + '.0.1',
		'wistla-' + deployment_name + '-dev',
		deployment_name + '.dev.wistla.com',
	] | join (' '), '\n' -%}

{%- endif -%}

{%- print '\n127.0.0.1 localhost\n' -%}

{%- if inventory_hostname in groups.vagrant -%}

	{%- print '\n# ---------- shortcut hosts for dev only\n\n' -%}

	{%- for host_name in groups.all if host_name in groups ['node-host'] -%}

		{%- set host = hostvars [host_name] -%}

		{%- if 'private_address' in host -%}

			{%- print [
				host.private_address,
				host.node_type + '-' + host.node_index | string,
			] | join (' ') + '\n' -%}

		{%- endif -%}

	{%- endfor -%}

{%- endif -%}

{%- for other_deployment_name, other_deployment in deployments.items ()
if 'bridge_network' in other_deployment
and (inventory_hostname in groups.vagrant
	or other_deployment.supercluster == supercluster_name
	or (inventory_hostname == 'wistla-ops-jenkins'
		and other_deployment.cluster == 'jenkins')) -%}

	{%- print '\n# ---------- deployment ', other_deployment_name, '\n\n' -%}

	{%- if other_deployment.cluster in [ 'dev', 'jenkins' ] -%}

		{%- print [
			other_deployment.bridge_network + '.0.1',
			'wistla-' + other_deployment_name + '-dev',
			other_deployment.main_domain,
		] | join (' '), '\n' -%}

		{%- for node_type in [
			'api',
			'browser',
			'load',
			'mongo',
			'rabbit',
			'web',
		] -%}
		{%- for node_index in range (4) -%}

			{%- print [
				[
					other_deployment.bridge_network,
					node_index | string,
					node_type_indices [node_type] | string,
				] | join ('.'),
				[
					other_deployment_name,
					node_type,
					node_index | string,
				] | join ('-'),
				[
					node_type + '-' + node_index | string,
					other_deployment.main_domain,
				] | join ('.'),
			] | join (' ') + '\n' -%}

		{%- endfor -%}
		{%- endfor -%}

		{%- if other_deployment_name == deployment_name
			or inventory_hostname == 'wistla-ops-jenkins' -%}

			{%- print '\n' -%}

			{%- for node_index in range (4) -%}

				{%- print [
					[
						other_deployment.bridge_network,
						node_index,
						node_type_indices.load,
					] | join ('.'),
					other_deployment.main_domain,
					other_deployment.api_domain,
					other_deployment.web_domain,
					other_deployment.assets_domain,
					other_deployment.admin_domain,
					other_deployment.short_domain,
				] | join (' ') + '\n' -%}

			{%- endfor -%}

		{%- endif -%}

	{%- elif other_deployment.type == 'shared' -%}

		{%- for node_type in [
			'mongo',
			'rabbit',
		] -%}
		{%- for node_zone in [ 'a', 'b', 'c' ] -%}
		{%- for node_index in range (256) -%}

			{%- print [
				[
					other_deployment.bridge_network,
					node_index | string,
					(cluster_zone_indices [node_zone] * 64
						+ node_type_indices [node_type]) | string,
				] | join ('.'),
				[
					other_deployment_name,
					node_type,
					node_zone,
					node_index | string,
				] | join ('-'),
				[
					node_type + '-' + node_zone + '-' + node_index | string,
					other_deployment.main_domain,
				] | join ('.'),
			] | join (' ') + '\n' -%}

		{%- endfor -%}
		{%- endfor -%}
		{%- endfor -%}

	{%- elif other_deployment.type == 'alias' -%}

		{%- for node_type in [
			'api',
			'browser',
			'load',
			'web',
		] -%}
		{%- for node_zone in [ 'a', 'b', 'c' ] -%}
		{%- for node_index in range (256) -%}

			{%- print [
				[
					other_deployment.bridge_network,
					node_index | string,
					(cluster_zone_indices [node_zone] * 64
						+ node_type_indices [node_type]) | string,
				] | join ('.'),
				[
					other_deployment_name,
					node_type,
					node_zone,
					node_index | string,
				] | join ('-'),
				[
					node_type + '-' + node_zone + '-' + node_index | string,
					other_deployment.main_domain,
				] | join ('.'),
			] | join (' ') + '\n' -%}

		{%- endfor -%}
		{%- endfor -%}
		{%- endfor -%}

	{%- elif other_deployment.type == 'simple' -%}

		{%- for node_type in [
			'api',
			'browser',
			'load',
			'mongo',
			'rabbit',
			'web',
		] -%}
		{%- for node_zone in [ 'a', 'b', 'c' ] -%}
		{%- for node_index in range (256) -%}

			{%- print [
				[
					other_deployment.bridge_network,
					node_index | string,
					(cluster_zone_indices [node_zone] * 64
						+ node_type_indices [node_type]) | string,
				] | join ('.'),
				[
					other_deployment_name,
					node_type,
					node_zone,
					node_index | string,
				] | join ('-'),
				[
					node_type + '-' + node_zone + '-' + node_index | string,
					other_deployment.main_domain,
				] | join ('.'),
			] | join (' ') + '\n' -%}

		{%- endfor -%}
		{%- endfor -%}
		{%- endfor -%}

	{%- endif -%}

{%- endfor -%}

{%- for other_cluster_name, other_cluster in clusters.items ()
if inventory_hostname in groups.vagrant
or other_cluster.supercluster_name == supercluster_name -%}

	{%- print '\n# ---------- cluster ', other_cluster_name, '\n\n' -%}

	{%- for cluster_host_name in groups ['cluster-' + other_cluster_name] -%}

		{%- set cluster_host = hostvars [cluster_host_name] -%}

		{%- if 'private_address' in cluster_host -%}

			{%- print [
				cluster_host.private_address,
				cluster_host_name,
				cluster_host_name + '.' + other_cluster.super_domain,
			] | join (' ') + '\n' -%}

		{%- endif -%}

	{%- endfor -%}

{% endfor %}
