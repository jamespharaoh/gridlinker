---

- name: "install system packages"
  with_items:

    - "procps"
    - "sysfsutils"

  become: "yes"
  action:

    module: "apt"
    name: "{{ item }}"

- name: "disable service startup"
  when: "is_template | default ('no') == 'yes'"
  become: "yes"
  action:

    module: "copy"
    dest: "/usr/sbin/policy-rc.d"
    content: "{{ '#!/bin/sh\n' + 'exit 101\n' }}"
    mode: "0755"

- name: "enable service startup"
  when: "is_template | default ('no') == 'no'"
  become: "yes"
  action:

    module: "file"
    path: "/usr/sbin/policy-rc.d"
    state: "absent"

- name: "install sysctl config"
  become: "yes"
  action:

    module: "template"
    dest: "/etc/sysctl.conf"
    src: "sysctl-config"

- name: "reload sysctl"
  when: "is_template | default ('no') == 'no'"
  become: "yes"
  command: "sysctl --load"

- name: "install sysfs config"
  become: "yes"
  action:

    module: "template"
    dest: "/etc/sysfs.conf"
    src: "sysfs-config"

- name: "reload sysfs"
  when: "is_template | default ('no') == 'no'"
  become: "yes"
  command: "service sysfsutils force-reload"

# ex: et ts=2 filetype=yaml
