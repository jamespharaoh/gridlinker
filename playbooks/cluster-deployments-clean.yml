---

# TODO generate this file

# ==================== cluster-staging

- hosts: "cluster-staging-admin:&cluster-instance-active"
  tasks:

    - name: "clean zookeeper"
      tags:

        - "cluster-deployment"

        - "staging"
        - "staging-a"
        - "staging-b"

      run_once: "yes"
      action:

        module: "znode"
        hosts: "{{ [
          'wistla-staging-admin-a:2181',
          'wistla-staging-admin-b:2181',
          'wistla-staging-admin-c:2181',
        ] | join (',') }}"
        name: "/staging/kafka"
        state: "absent"

- hosts: "cluster-staging-app:&cluster-instance-active"
  roles:

    - role: "cluster-deployment-playbook"
      when: "amazon_instance_state == 'running'"
      cluster_deployment_name: "staging-a"
      cluster_deployment_playbook_name: "clean-data"
      tags: [ "cluster-deployment", "staging-a" ]

    - role: "cluster-deployment-playbook"
      when: "amazon_instance_state == 'running'"
      cluster_deployment_name: "staging-b"
      cluster_deployment_playbook_name: "clean-data"
      tags: [ "cluster-deployment", "staging-b" ]

- hosts: "cluster-staging-data:&cluster-instance-active"
  roles:

    - role: "cluster-deployment-playbook"
      when: "amazon_instance_state == 'running'"
      cluster_deployment_name: "staging"
      cluster_deployment_playbook_name: "clean-data"
      tags: [ "cluster-deployment", "staging" ]

# ==================== cluster-staging-2

- hosts: "cluster-staging-2-admin:&cluster-instance-active"
  tasks:

    - name: "clean zookeeper"
      tags:

        - "cluster-deployment"

        - "staging-2"
        - "staging-2-a"
        - "staging-2-b"

      run_once: "yes"
      action:

        module: "znode"
        hosts: "{{ [
          'wistla-staging-2-admin-a:2181',
          'wistla-staging-2-admin-b:2181',
          'wistla-staging-2-admin-c:2181',
        ] | join (',') }}"
        name: "/staging-2/kafka"
        state: "absent"

- hosts: "cluster-staging-2-app:&cluster-instance-active"
  roles:

    - when: "amazon_instance_state == 'running'"
      tags:

        - "cluster-deployment"
        - "staging-2-a"

      role: "cluster-deployment-playbook"

      cluster_deployment_name: "staging-2-a"
      cluster_deployment_playbook_name: "clean-data"

    - when: "amazon_instance_state == 'running'"
      tags:

        - "cluster-deployment"
        - "staging-2-b"

      role: "cluster-deployment-playbook"

      cluster_deployment_name: "staging-2-b"
      cluster_deployment_playbook_name: "clean-data"

- hosts: "cluster-staging-2-data:&cluster-instance-active"
  roles:

    - when: "amazon_instance_state == 'running'"
      tags:

        - "cluster-deployment"
        - "staging-2"

      role: "cluster-deployment-playbook"

      cluster_deployment_name: "staging-2"
      cluster_deployment_playbook_name: "clean-data"

# ==================== cluster-test

- hosts: "cluster-test-admin:&cluster-instance-active"
  tasks:

    - name: "clean zookeeper"
      tags:

        - "cluster-deployment"

        - "test-erebus"

      run_once: "yes"
      action:

        module: "znode"
        hosts: "{{ [
          'wistla-test-admin-a:2181',
          'wistla-test-admin-b:2181',
          'wistla-test-admin-c:2181',
        ] | join (',') }}"
        name: "/test-erebus/kafka"
        state: "absent"

    - name: "clean zookeeper"
      tags:

        - "cluster-deployment"

        - "test-everest"

      run_once: "yes"
      action:

        module: "znode"
        hosts: "{{ [
          'wistla-test-admin-a:2181',
          'wistla-test-admin-b:2181',
          'wistla-test-admin-c:2181',
        ] | join (',') }}"
        name: "/test-everest/kafka"
        state: "absent"

    - name: "clean zookeeper"
      tags:

        - "cluster-deployment"

        - "test-fitzroy"

      run_once: "yes"
      action:

        module: "znode"
        hosts: "{{ [
          'wistla-test-admin-a:2181',
          'wistla-test-admin-b:2181',
          'wistla-test-admin-c:2181',
        ] | join (',') }}"
        name: "/test-fitzroy/kafka"
        state: "absent"

    - name: "clean zookeeper"
      tags:

        - "cluster-deployment"

        - "test-k2"

      run_once: "yes"
      action:

        module: "znode"
        hosts: "{{ [
          'wistla-test-admin-a:2181',
          'wistla-test-admin-b:2181',
          'wistla-test-admin-c:2181',
        ] | join (',') }}"
        name: "/test-k2/kafka"
        state: "absent"

    - name: "clean zookeeper"
      tags:

        - "cluster-deployment"

        - "test-montblanc"

      run_once: "yes"
      action:

        module: "znode"
        hosts: "{{ [
          'wistla-test-admin-a:2181',
          'wistla-test-admin-b:2181',
          'wistla-test-admin-c:2181',
        ] | join (',') }}"
        name: "/test-montblanc/kafka"
        state: "absent"

- hosts: "cluster-test-app:&cluster-instance-active"
  roles:

    - role: "cluster-deployment-playbook"
      when: "amazon_instance_state == 'running'"
      cluster_deployment_name: "test-everest"
      cluster_deployment_playbook_name: "clean-data"
      tags: [ "cluster-deployment", "test-everest" ]

    - role: "cluster-deployment-playbook"
      when: "amazon_instance_state == 'running'"
      cluster_deployment_name: "test-k2"
      cluster_deployment_playbook_name: "clean-data"
      tags: [ "cluster-deployment", "test-k2" ]

    - role: "cluster-deployment-playbook"
      when: "amazon_instance_state == 'running'"
      cluster_deployment_name: "test-montblanc"
      cluster_deployment_playbook_name: "clean-data"
      tags: [ "cluster-deployment", "test-montblanc" ]

    - role: "cluster-deployment-playbook"
      when: "amazon_instance_state == 'running'"
      cluster_deployment_name: "test-erebus"
      cluster_deployment_playbook_name: "clean-data"
      tags: [ "cluster-deployment", "test-erebus" ]

    - role: "cluster-deployment-playbook"
      when: "amazon_instance_state == 'running'"
      cluster_deployment_name: "test-fitzroy"
      cluster_deployment_playbook_name: "clean-data"
      tags: [ "cluster-deployment", "test-fitzroy" ]

# ex: et ts=2 filetype=yaml
