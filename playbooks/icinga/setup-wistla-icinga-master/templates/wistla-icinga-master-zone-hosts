{{ ansible_warning ['//'] }}

{% set cluster_name = item.0 %}
{% set cluster = clusters [cluster_name] %}

# ==================== admin instances

{% for host_name in groups ['cluster-' + cluster_name + '-admin'] %}
{% set host = hostvars [host_name] %}

object Host "{{ host_name }}" {

	import "generic-host"

	address = "{{ host_name }}"

	vars.endpoint = "{{ host_name }}"
	vars.cluster = "{{ cluster_name }}"
	vars.type = "admin"

	vars.disks ["disk system"] = {
		disk_partitions = "/"
	}

}

{% endfor %}

{% if 'cluster-' + cluster_name + '-app' in groups %}

# ==================== app instances

{% for host_name in groups ['cluster-' + cluster_name + '-app'] %}
{% set host = hostvars [host_name] %}

object Host "{{ host_name }}" {

	import "generic-host"

	address = "{{ host_name }}"

	vars.endpoint = "{{ host_name }}"
	vars.cluster = "{{ cluster_name }}"
	vars.type = "app"

	vars.disks ["disk system"] = {
		disk_partitions = "/"
	}

	vars.disks ["disk containers"] = {
		disk_partitions = "/var/lib/lxc"
	}

	vars.disks ["disk data"] = {
		disk_partitions = "/data"
	}

}

{% endfor %}
{% endif %}

{% if 'cluster-' + cluster_name + '-jenkins' in groups %}

# ==================== app instances

{% for host_name in groups ['cluster-' + cluster_name + '-jenkins'] %}
{% set host = hostvars [host_name] %}

object Host "{{ host_name }}" {

	import "generic-host"

	address = "{{ host_name }}"

	vars.endpoint = "{{ host_name }}"
	vars.cluster = "{{ cluster_name }}"
	vars.type = "jenkins"

	vars.disks ["disk system"] = {
		disk_partitions = "/"
	}

	vars.disks ["disk containers"] = {
		disk_partitions = "/var/lib/lxc"
	}

	vars.disks ["disk data"] = {
		disk_partitions = "/data"
	}

}

{% endfor %}
{% endif %}
