{{ ansible_warning ['//'] }}

{% for other_cluster_name, other_cluster in clusters.items () %}

# ==================== cluster {{ other_cluster_name }}

object HostGroup "cluster-{{ other_cluster_name }}" {

	display_name = "Cluster {{ other_cluster_name }}"

	assign where host.vars.cluster == "{{ other_cluster_name }}"

}

# --------- admin instances

{% for host_name in groups ['cluster-' + other_cluster_name + '-admin'] %}
{% set host = hostvars [host_name] %}

object Host "{{ host_name }}" {

	import "generic-host"

	address = "{{ host_name }}"

	command_endpoint = "wistla-{{ other_cluster_name }}-admin-a"

	vars.endpoint = "{{ host_name }}"
	vars.cluster = "{{ other_cluster_name }}"
	vars.type = "admin"

	vars.disks ["disk system"] = {
		disk_partitions = "/"
	}

}

{% endfor %}

{% if 'cluster-' + other_cluster_name + '-app' in groups %}

# ---------- app instances

{% for host_name in groups ['cluster-' + other_cluster_name + '-app'] %}
{% set host = hostvars [host_name] %}

object Host "{{ host_name }}" {

	import "generic-host"

	address = "{{ host_name }}"

	command_endpoint = "wistla-{{ other_cluster_name }}-admin-a"

	vars.endpoint = "{{ host_name }}"
	vars.cluster = "{{ other_cluster_name }}"
	vars.type = "app"

	vars.disks ["disk system"] = {
		disk_partitions = "/"
	}

	vars.disks ["disk containers"] = {
		disk_partitions = "/var/lib/lxc"
	}

	vars.disks ["disk data"] = {
		disk_partitions = "/data"
	}

}

{% endfor %}
{% endif %}

{% if 'cluster-' + other_cluster_name + '-data' in groups %}

# ---------- data instances

{% for host_name in groups ['cluster-' + other_cluster_name + '-data'] %}
{% set host = hostvars [host_name] %}

object Host "{{ host_name }}" {

	import "generic-host"

	address = "{{ host_name }}"

	command_endpoint = "wistla-{{ other_cluster_name }}-admin-a"

	vars.endpoint = "{{ host_name }}"
	vars.cluster = "{{ other_cluster_name }}"
	vars.type = "data"

	vars.disks ["disk system"] = {
		disk_partitions = "/"
	}

	vars.disks ["disk containers"] = {
		disk_partitions = "/var/lib/lxc"
	}

	vars.disks ["disk data"] = {
		disk_partitions = "/data"
	}

}

{% endfor %}
{% endif %}

{% if 'cluster-' + other_cluster_name + '-jenkins' in groups %}

# ---------- jenkins instances

{% for host_name in groups ['cluster-' + other_cluster_name + '-jenkins'] %}
{% set host = hostvars [host_name] %}

object Host "{{ host_name }}" {

	import "generic-host"

	address = "{{ host_name }}"

	command_endpoint = "wistla-{{ other_cluster_name }}-admin-a"

	vars.endpoint = "{{ host_name }}"
	vars.cluster = "{{ other_cluster_name }}"
	vars.type = "jenkins"

	vars.disks ["disk system"] = {
		disk_partitions = "/"
	}

	vars.disks ["disk containers"] = {
		disk_partitions = "/var/lib/lxc"
	}

	vars.disks ["disk data"] = {
		disk_partitions = "/data"
	}

}

{% endfor %}
{% endif %}

{% endfor %}
