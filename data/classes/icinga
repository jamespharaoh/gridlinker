---

identity:

  name: "icinga"
  type: "class"

class:

  namespace: "host"
  parent_namespace: "host"

  groups:

    - "icinga-masters"
    - "rocket-hz"

  references:

    - name: "super_cluster"
      type: "resource"
      value: "cluster/master"

ansible:

  ssh_host: "{{ private.address }}"
  ssh_user: "ubuntu"

ssh:

  hostnames:

    - "{{ identity.name }}"
    - "{{ private.address }}"

icinga:

  authority: "rocket-icinga"
  ca_certificate: "/authority/{{ icinga_authority }}/certificate"

  alt_dns:

    - "{{ identity_name }}"
    - "{{ identity_name }}.vpn"

  master: "{{ super_cluster.icinga_master }}"

  database_type: "{{ super_cluster.icinga_database_type }}"
  database_hostname: "{{ super_cluster.icinga_database_hostname }}"
  database_port: "{{ super_cluster.icinga_database_port }}"
  database_username: "{{ super_cluster.icinga_database_username }}"
  database_password: "{{ super_cluster.icinga_database_password }}"

  master_services:

    - for_key: "disk"
      for_value: "config"
      for_var: "host.vars.disks"
      check_command: "disk"
      add_vars: "config"
      assign_where: "host.vars.disks"
      command_endpoint: "host.name"

icinga_endpoint:

  host: "{{ identity_name }}.vpn"
  internal: "{{ identity_name }}.vpn"
  external: "{{ identity_name }}.vpn"

icinga_host:

  address: "{{ identity_name }}.vpn"

  vars:

    - name: "notification_groups"
      type: "array"
      value:

        - type: "string"
          value: "admins"

icinga_web:

  version: "{{ super_cluster.icinga_web_version }}"

  hostname: "monitoring.datingnode.com"
  security: "none"

  database_type: "{{ super_cluster.icinga_web_database_type }}"
  database_hostname: "{{ super_cluster.icinga_web_database_hostname }}"
  database_port: "{{ super_cluster.icinga_web_database_port }}"
  database_username: "{{ super_cluster.icinga_web_database_username }}"
  database_password: "{{ super_cluster.icinga_web_database_password }}"

nginx:

  version: "1.9.4"

php:

  packages:

    - "php5-cli"
    - "php5-fpm"
    - "php5-pgsql"

# ex: et ts=2 filetype=yaml
