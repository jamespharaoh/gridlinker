---

identity:

  name: "vhost-proxy"
  type: "class"

class:

  namespace: "host"
  parent_namespace: "host"

  groups:

    - "containers"
    - "{{ identity_cluster }}-vhost-proxy"
    - "{{ identity_cluster }}-{{ identity_index }}"

  references:

    - name: "cluster"
      type: "resource"
      value: "cluster/{{ identity_cluster }}"
      section: "cluster"

container:

  type: "vhost-proxy"
  directory: "/datingnode-{{ identity_cluster }}/{{ identity_name }}"

start:

  name: "{{ identity_name }}"
  registry: "{{ docker_registry }}"
  image: "{{ docker_images.vhost_proxy }}:{{ cluster.build.vhost_proxy }}"

  expose:
    - "80"
    - "443"

  ports:
    - "{{ cluster.ports.vhost_proxy }}:80"
    - "{{ cluster.ports.vhost_proxy_ssl }}:443"

  volumes:
    - "{{ container_directory }}/config:/config"
    - "{{ container_directory }}/data:/data"
    - "/datingnode-ssl:/config/ssl"

  env: {}

  wait:
    - "80"
    - "443"

  reload_commands:
    - "/etc/my_init.d/ansible"
    - "sv hup nginx"

# ex: et ts=2 filetype=yaml# ex: et ts=2 filetype=yaml
