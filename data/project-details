---

# ---------- devops

- name: "wistla-devops"
  default_branch: "development"
  configs:

    - "config"
    - "data/runtime"
    - "security"

  jenkins_build_steps:

    - "scripts/setup-project build"

- name: "wistla-jenkins-config"
  default_branch: "master"

# ---------- integration

- name: "wistla-integration"
  default_branch: "development"

# ---------- modules

- name: "wistla-api-server"
  default_branch: "development"
  npm_name: "@wistla/api-server"
  depends:

    - "wistla-data-process"
    - "wistla-db"
    - "wistla-logging"
    - "wistla-media"
    - "wistla-pubsub"
    - "wistla-raml-api"
    - "wistla-raml-server"
    - "wistla-test"
    - "wistla-util"
    # todo: remove when this is running in the "environments"
    # todo: container
    - "wistla-db-schema"

  build_steps:

    - "npm install"
    - "npm run build"

- name: "wistla-blob"
  default_branch: "development"
  npm_name: "@wistla/blob"

  depends:

    - "wistla-logging"
    - "wistla-test"
    - "wistla-util"

  build_steps:

    - "npm install"

- name: "wistla-data-export"
  short: "export legacy mongo to json files"
  default_branch: "development"
  npm_name: "@wistla/wistla-data-export"
  description:

    extracts data from mongo into individual json files per postgres

  depends:

    - "wistla-db"
    - "wistla-test"
    - "wistla-util"

  build_steps:

    - "npm install"

- name: "wistla-data-import"
  short: "import legacy json into postgres"
  default_branch: "development"
  npm_name: "@wistla/wistla-data-import"
  description:

    reads files exported using wistla-data-export and imports them into postgres

  depends:

    - "wistla-db"
    - "wistla-test"
    - "wistla-util"

- name: "wistla-data-process"
  short: "transform sql resultset into json for api"
  default_branch: "development"
  npm_name: "@wistla/wistla-data-process"
  depends:

    - "wistla-db"
    - "wistla-logging"
    - "wistla-raml-api"
    - "wistla-raml-to-api"
    - "wistla-util"
    - "wistla-test"

  build_steps:

    - "npm install"
    - "npm run build-api"

- name: "wistla-db"
  short: "database connection abstractions for mongo and postgres"
  default_branch: "development"
  npm_name: "@wistla/wistla-db"
  description:

    lower level module that handles connecting to mongo/postgres

  depends:

    - "wistla-logging"
    - "wistla-util"
    - "wistla-test"

  build_steps:

    - "npm install"

- name: "wistla-db-daemon"
  default_branch: "development"
  npm_name: "@wistla/db-daemon"
  description:

    brokers changes from main db to cache dbs

  depends:

    - "wistla-db"
    - "wistla-logging"
    - "wistla-pubsub"
    - "wistla-util"
    - "wistla-test"

  build_steps:

    - "npm install"

- name: "wistla-db-schema"
  short: "sql schema definitions"
  default_branch: "development"
  npm_name: "@wistla/wistla-db-schema"
  description:

    the postgres db schema and helper scripts to import/export and
    assemble/split the schema

  depends:

    - "wistla-util"
    - "wistla-data-process"

  build_steps:

    - "npm install"

- name: "wistla-email"
  short: "sending emails et al"
  default_branch: "development"
  npm_name: "@wistla/email"

  depends:

    - "wistla-db"
    - "wistla-i18n"
    - "wistla-logging"
    - "wistla-pubsub"
    - "wistla-util"
    - "wistla-test"

  build_steps:

    - "npm install"

- name: "wistla-i18n"
  short: "internationalisation"
  default_branch: "development"
  npm_name: "@wistla/i18n"
  description:

    internationalisation

  depends:

    - "wistla-util"

  build_steps:

    - "npm install"

- name: "wistla-logging"
  short: "logging module"
  default_branch: "development"
  npm_name: "@wistla/logging"
  description:

    logging module

  build_steps:

    - "npm install"

- name: "wistla-media"
  short: "media handling"
  default_branch: "development"
  npm_name: "@wistla/media"

  depends:

    - "wistla-blob"
    - "wistla-db"
    - "wistla-logging"
    - "wistla-pubsub"
    - "wistla-util"
    - "wistla-test"

  build_steps:

    - "npm install"

- name: "wistla-media-daemon"
  default_branch: "development"
  npm_name: "@wistla/media-daemon"
  description:

    listens for media uploads and does what's necessary to survive

  depends:

    - "wistla-db"
    - "wistla-logging"
    - "wistla-media"
    - "wistla-pubsub"
    - "wistla-util"
    - "wistla-test"

  build_steps:

    - "npm install"

- name: "wistla-notification-daemon"
  default_branch: "development"
  npm_name: "@wistla/notification-daemon"
  description:

    listens for notifications and does what's necessary to survive

  depends:

    - "wistla-db"
    - "wistla-email"
    - "wistla-logging"
    - "wistla-notifications"
    - "wistla-pubsub"
    - "wistla-util"
    - "wistla-test"

  build_steps:

    - "npm install"

- name: "wistla-notifications"
  short: "send push notifications"
  default_branch: "development"
  npm_name: "@wistla/notifications"

  depends:

    - "wistla-db"
    - "wistla-i18n"
    - "wistla-logging"
    - "wistla-pubsub"
    - "wistla-util"
    - "wistla-test"

  build_steps:

    - "npm install"

- name: "wistla-pubsub"
  short: "wistla pub/sub message queue razzamatazz"
  default_branch: "development"
  npm_name: "@wistla/pubsub"
  description:

    wistla pub/sub message queue razzamatazz

  depends:

    - "wistla-db"
    - "wistla-logging"
    - "wistla-util"
    - "wistla-test"

  build_steps:

    - "npm install"

- name: "wistla-raml-api"
  short: "wistla api definition in raml"
  default_branch: "development"
  npm_name: "@wistla/raml-api"
  description:

    the wistla v2 API defined in RAML 1.0 format

  depends:

    - "wistla-util"

  build_steps:

    - "npm install"

- name: "wistla-raml-server"
  short: "generate api code from json api definition"
  default_branch: "development"
  npm_name: "@wistla/raml-server"
  description:

    module to generate API endpoints and HTTP server(s) based on the JSON
    generated by wistla-raml-to-api

  depends:

    - "wistla-logging"
    - "wistla-raml-api"
    - "wistla-raml-to-api"
    - "wistla-test"
    - "wistla-util"

  build_steps:

    - "npm install"

- name: "wistla-raml-to-api"
  short: "general json api definition from raml"
  default_branch: "development"
  npm_name: "@wistla/raml-to-api"
  description:

    module to convert RAML 1.0 markup into JSON that can be used to generate API
    endpoints and HTTP server(s); as well as the data transforms

  depends:

    - "wistla-logging"
    - "wistla-raml-api"
    - "wistla-test"
    - "wistla-util"

  build_steps:

    - "npm install"

- name: "wistla-share"
  short: "dynamic website content for sharing etc"
  default_branch: "development"
  npm_name: "@wistla/share"
  description:

    server for dynamic web content used when sharing wistls, and possibly for
    more in the future

  depends:

    - "wistla-logging"
    - "wistla-test"
    - "wistla-util"

  build_steps:

    - "npm install"

- name: "wistla-test"
  short: "testing related shizzle"
  default_branch: "development"
  npm_name: "@wistla/test"

  depends:

    - "wistla-util"

  build_steps:

    - "npm install"

- name: "wistla-util"
  short: "generic helpers that are used across @wistla/* modules"
  default_branch: "development"
  npm_name: "@wistla/util"
  description:

    generic helpers that are used across @wistla/* modules

  build_steps:

    - "npm install"

# ---------- content

- name: "content-browser"
  short: "content for legacy wistla-browser project"
  default_branch: "master"

- name: "content-iOS"
  short: "content for ios client"
  default_branch: "master"

- name: "content-api"
  short: "content for legacy wistla-api project"
  default_branch: "master"

- name: "content-common"
  short: "shared content"
  default_branch: "master"

- name: "wistla-test-images"
  short: "content used by tests"
  default_branch: "master"

# ---------- miscellaneous

- name: "wistla-iOS"
  short: "ios client"
  default_branch: "master"

- name: "wistla-scripts"
  short: "shared scripts"
  default_branch: "master"

# ---------- legacy

- name: "wistla-api"
  short: "legacy api server and logic"
  default_branch: "master"
  npm_name: "wistla-api"
  nodejs_version: "legacy"
  depends:

    - "wistla-analytics"

  build_steps:

    - "npm install"

- name: "wistla-analytics"
  short: "legacy analytics client library"
  default_branch: "master"
  npm_name: "wistla-analytics"
  build_steps:

    - "npm install"

- name: "wistla-browser"
  short: "legacy api client for web browser access"
  default_branch: "master"
  npm_name: "wistla-browser"
  nodejs_version: "legacy"
  depends:

    - "wistla-analytics"

  build_steps:

    - "npm install"

# ex: et ts=2 filetype=yaml
