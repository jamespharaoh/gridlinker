---

# ---------- devops

- name: "wistla-devops"
  configs:

    - "config"
    - "data/runtime"
    - "security"

# ---------- integration

# TODO

# ---------- modules

- name: "api-stub-server"
  short: "stub server for basic testing"
  npm_name: "@wistla/api-stub-server"
  depends:

    - "wistla-raml-server"

  build_steps:

    - "npm install"

- name: "wistla-api-server"
  npm_name: "@wistla/api-server"
  depends:

    - "wistla-data-process"
    - "wistla-db"
    - "wistla-raml-api"
    - "wistla-raml-server"

  build_steps:

    - "npm install"

- name: "wistla-data-export"
  short: "export legacy mongo to json files"
  npm_name: "@wistla/wistla-data-export"
  description:

    extracts data from mongo into individual json files per postgres

  depends:

    - "wistla-db"

- name: "wistla-data-import"
  short: "import legacy json into postgres"
  npm_name: "@wistla/wistla-data-import"
  description:

    reads files exported using wistla-data-export and imports them into postgres

  depends:

    - "wistla-db"

- name: "wistla-data-process"
  short: "transform sql resultset into json for api"
  npm_name: "@wistla/wistla-data-process"
  depends:

    - "wistla-db"
    - "wistla-raml-api"
    - "wistla-raml-to-api"

  build_steps:

    - "npm install"

- name: "wistla-db"
  short: "database connection abstractions for mongo and postgres"
  npm_name: "@wistla/wistla-db"
  description:

    lower level module that handles connecting to mongo/postgres

- name: "wistla-db-schema"
  short: "sql schema definitions"
  npm_name: "@wistla/wistla-db-schema"
  description:

    the postgres db schema and helper scripts to import/export and
    assemble/split the schema

- name: "wistla-raml-api"
  short: "wistla api definition in raml"
  npm_name: "@wistla/raml-api"
  description:

    the wistla v2 API defined in RAML 1.0 format

- name: "wistla-raml-server"
  short: "generate api code from json api definition"
  npm_name: "@wistla/raml-server"
  description:

    module to generate API endpoints and HTTP server(s) based on the JSON
    generated by wistla-raml-to-api

  depends:

    - "wistla-raml-to-api"

- name: "wistla-raml-to-api"
  short: "general json api definition from raml"
  npm_name: "@wistla/raml-to-api"
  description:

    module to convert RAML 1.0 markup into JSON that can be used to generate API
    endpoints and HTTP server(s); as well as the data transforms

# ---------- content

- name: "content-browser"
  short: "content for legacy wistla-browser project"

- name: "content-iOS"
  short: "content for ios client"

- name: "content-api"
  short: "content for legacy wistla-api project"

- name: "content-common"
  short: "shared content"

# ---------- miscellaneous

- name: "wistla-iOS"
  short: "ios client"

- name: "wistla-scripts"
  short: "shared scripts"

# ---------- legacy

- name: "wistla-api"
  short: "legacy api server and logic"
  nodejs_version: "legacy"
  project_links:

    - link: "node_modules/wistla-analytics"
      overlay: "node_modules/.wistla-analytics"
      target: "{{ deployment_home }}/wistla-analytics"

  build_steps:

    - "npm install"

- name: "wistla-analytics"
  short: "legacy analytics client library"
  build_steps:

    - "npm install"

- name: "wistla-browser"
  short: "legacy api client for web browser access"
  nodejs_version: "legacy"
  project_links:

    - link: "node_modules/wistla-analytics"
      overlay: "node_modules/.wistla-analytics"
      target: "{{ deployment_home }}/wistla-analytics"

  build_steps:

    - "npm install"

# ex: et ts=2 filetype=yaml
