---

- name: "reset icinga state"
  hosts: "cluster-admin"
  tasks:

    - name: "shut down icinga"
      action:
        module: "service"
        name: "icinga2"
        state: "stopped"
      sudo: "yes"

    - name: "delete data"
      action:
        module: "file"
        path: "/var/lib/icinga2/{{ item }}"
        state: "absent"
      sudo: "yes"
      with_items:
        - "api/log"
        - "api/repository"
        - "api/zones"
        - "icinga2.state"

    - name: "delete cache"
      action:
        module: "file"
        path: "/var/cache/icinga2/{{ item }}"
        state: "absent"
      sudo: "yes"
      with_items:
        - "icinga2.debug"
        - "icinga2.vars"
        - "objects.cache"
        - "status.dat"

    - name: "delete logs"
      action:
        module: "file"
        path: "/var/log/icinga2/{{ item }}"
        state: "absent"
      sudo: "yes"
      with_items:
        - "debug.log"
        - "icinga2.err"
        - "icinga2.log"
        - "notice.log"
        - "startup.log"

    - name: "recreate dirs"
      action:
        module: "file"
        path: "/var/lib/icinga2/{{ item }}"
        state: "directory"
        owner: "nagios"
        group: "nagios"
        mode: "0750"
      sudo: "yes"
      with_items:
        - "api/log"
        - "api/repository"
        - "api/zones"

    - name: "start icinga"
      action:
        module: "service"
        name: "icinga2"
        state: "started"
      sudo: "yes"

# ex: et ts=2 filetype=yaml
