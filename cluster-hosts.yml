---

# ========== admin

- hosts: "cluster-admin"
  roles:

    # ----- create

    - role: "cluster-create"
      tags: [ "cluster-create" ]

    # ----- system

    - role: "cluster-admin"
      tags: [ "cluster-admin" ]

    - role: "install-kernel"
      tags: [ "install-kernel" ]

    - role: "setup-system"
      tags: [ "setup-system" ]

    - role: "cluster-ssh"
      tags: [ "cluster-user" ]

    - role: "install-postfix"
      tags: [ "install-postfix" ]

    - role: "setup-common-users"
      tags: [ "setup-common-users" ]

    - role: "cluster-user"
      tags: [ "cluster-user" ]

    # ----- services

    #- role: "cluster-icinga"
    #  tags: [ "cluster-icinga" ]

    # ----- final steps

    - role: "cluster-activate"
      when: "cluster == 'ops'"
      tags: [ "cluster-activate" ]

# ========== app

- hosts: "cluster-app"
  roles:

    # ----- create

    - role: "cluster-create"
      when: "cluster != 'ops'"
      tags: [ "cluster-create" ]

    # ----- system

    - role: "cluster-app"
      when: "cluster != 'ops'"
      tags: [ "cluster-app" ]

    - role: "cluster-volumes"
      when: "cluster != 'ops'"
      tags: [ "cluster-volumes" ]

    - role: "install-kernel"
      when: "cluster != 'ops'"
      tags: [ "install-kernel" ]

    - role: "setup-system"
      when: "cluster != 'ops'"
      tags: [ "setup-system" ]

    - role: "cluster-ssh"
      when: "cluster != 'ops'"
      tags: [ "cluster-user" ]

    - role: "install-postfix"
      when: "cluster != 'ops'"
      tags: [ "install-postfix" ]

    - role: "setup-common-users"
      when: "cluster != 'ops'"
      tags: [ "setup-common-users" ]

    - role: "install-nodejs"
      when: "cluster != 'ops'"
      tags: [ "install-nodejs" ]

    - role: "install-iojs"
      when: "cluster != 'ops'"
      tags: [ "install-iojs" ]

    - role: "setup-alternatives"
      when: "cluster != 'ops'"
      tags: [ "setup-alternatives" ]

    - role: "install-node-packages"
      when: "cluster != 'ops'"
      tags: [ "install-node-packages" ]

    - role: "cluster-user"
      when: "cluster != 'ops'"
      tags: [ "cluster-user" ]

    # ----- services

    #- role: "cluster-icinga"
    #  when: "cluster != 'ops'"
    #  tags: [ "cluster-icinga" ]

    # ----- final steps

    - role: "cluster-activate"
      tags: [ "cluster-activate" ]

# ========== jenkins

- hosts: "cluster-jenkins"
  roles:

    # ----- create

    - role: "cluster-create"
      tags: [ "cluster-create" ]

    # ----- system

    - role: "cluster-volumes"
      when: "cluster == 'ops'"
      tags: [ "cluster-volumes" ]

    - role: "install-kernel"
      when: "cluster == 'ops'"
      tags: [ "install-kernel" ]

    - role: "setup-system"
      when: "cluster == 'ops'"
      tags: [ "setup-system" ]

    - role: "cluster-ssh"
      when: "cluster == 'ops'"
      tags: [ "cluster-user" ]

    - role: "install-postfix"
      when: "cluster == 'ops'"
      tags: [ "install-postfix" ]

    - role: "setup-common-users"
      when: "cluster == 'ops'"
      tags: [ "setup-common-users" ]

    - role: "install-nodejs"
      when: "cluster == 'ops'"
      tags: [ "install-nodejs" ]

    - role: "install-iojs"
      when: "cluster == 'ops'"
      tags: [ "install-iojs" ]

    - role: "setup-alternatives"
      when: "cluster == 'ops'"
      tags: [ "setup-alternatives" ]

    - role: "install-node-packages"
      when: "cluster == 'ops'"
      tags: [ "install-node-packages" ]

    # ----- services

    - role: "cluster-user"
      when: "cluster == 'ops'"
      tags: [ "cluster-user" ]

    - role: "cluster-jenkins"
      when: "cluster == 'ops'"
      tags: [ "cluster-jenkins" ]

    #- role: "cluster-icinga"
    #  when: "cluster == 'ops'"
    #  tags: [ "cluster-icinga" ]

# ex: et ts=2 filetype=yaml
