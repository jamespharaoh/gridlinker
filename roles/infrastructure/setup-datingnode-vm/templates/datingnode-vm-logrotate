# keep 30 days of rotated logs
daily
rotate 30

# run as root with syslog group
su root syslog

# create missing logfiles
create

# compress log files after one day
compress
delaycompress

# include config from packages
include /etc/logrotate.d

# handle wtmp
/var/log/wtmp {
    missingok
    create 0664 root utmp
}

# handle btmp
/var/log/btmp {
    missingok
    create 0660 root utmp
}

# compress apache access logs
{% for env in [ 'live', 'staging' ] %}
{% set container = env + '-web-application-' + identity_index %}
{% set directory = '/datingnode-' + env + '/' + container + '/fast/logs' %}
{{ [
	directory + '/*-apache-access.log',
	directory + '/*-apache-error.log',
] | join (' ') }} {
	daily
	missingok
	rotate 365
	compress
	delaycompress
	notifempty
	create 640 root adm
	postrotate
		docker exec {{ container }} /etc/init.d/apache2 reload >/dev/null
	endscript
}
{% endfor %}
