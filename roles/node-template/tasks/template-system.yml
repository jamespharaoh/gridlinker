---

- name: "disable service startup"
  action:
    module: "template"
    src: "template-policy-rcd"
    dest: "/usr/sbin/policy-rc.d"
    mode: "0755"
  sudo: "yes"
  when: "inventory_hostname in groups.template"

- name: "enable service startup"
  action:
    module: "file"
    path: "/usr/sbin/policy-rc.d"
    state: "absent"
  sudo: "yes"
  when: "inventory_hostname not in groups.template"

- include_vars: "data/ssh-host-keys"

- name: "create apt sources.list"
  action:
    module: "template"
    src: "template-apt-sources-list"
    dest: "/etc/apt/sources.list"
  sudo: "yes"
  sudo_user: "root"

- name: "create hosts file"
  action:
    module: "template"
    src: "template-hosts"
    dest: "/etc/hosts"
  sudo: "yes"
  sudo_user: "root"

- name: "create resolv.conf"
  action:
    module: "template"
    src: "template-resolv-conf"
    dest: "/etc/resolv.conf"
  sudo: "yes"
  sudo_user: "root"

- name: "create network interfaces"
  action:
    module: "template"
    src: "template-network-interfaces"
    dest: "/etc/network/interfaces"
  sudo: "yes"
  sudo_user: "root"

- name: "create common groups"
  action:
    module: "group"
    name: "{{ item.name }}"
    gid: "{{ item.gid }}"
    system: "yes"
  sudo: "yes"
  sudo_user: "root"
  with_items: "common_users"

- name: "create common users"
  action:
    module: "user"
    name: "{{ item.name }}"
    group: "{{ item.name }}"
    uid: "{{ item.uid }}"
    home: "{{ item.home }}"
    createhome: "no"
    shell: "{{ item.shell }}"
    system: "yes"
  sudo: "yes"
  sudo_user: "root"
  with_items: "common_users"

- name: "install system packages"
  action:
    module: "apt"
    state: "present"
    name: "{{ item }}"
  sudo: "yes"
  sudo_user: "root"
  with_items: "global_install_packages"

- name: "remove system packages"
  action:
    module: "apt"
    state: "absent"
    name: "{{ item }}"
  sudo: "yes"
  sudo_user: "root"
  with_items: "global_remove_packages"

- name: "install ssh known hosts"
  action:
    module: "template"
    src: "template-ssh-known-hosts"
    dest: "/etc/ssh/ssh_known_hosts"
  sudo: "yes"
  sudo_user: "root"

# ex: et ts=2 filetype=yaml
