---

- name: "upload builds"
  args:

    executable: "/bin/bash"

  delegate_to: "localhost"
  shell:

    set -euf -o pipefail;

    if test "{{ deployment_mode }}" = "vagrant"; then
      eval $(misc/amazon-auth ops);
    fi;

    aws s3 sync
      "{{ builds_path }}"
      "s3://wistla-builds/zbackup"
      --size-only
      --exclude 'snapshots/*';

# ex: et ts=2 filetype=yaml
