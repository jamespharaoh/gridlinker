---

- name: "create deployment bridge network interface"
  action:
    module: "template"
    src: "cluster-app-interface-bridge"
    dest: "/etc/network/interfaces.d/{{ deployments [item].bridge_name }}.cfg"
  sudo: "yes"
  with_items: "cluster_deployment_names"

- name: "start deployment network bridge"
  shell:

    set -e

    if ifquery --state {{ deployments [item].bridge_name }} >/dev/null; then
      echo "UNCHANGED";
      exit;
    fi

    ifup {{ deployments [item].bridge_name }};

  sudo: "yes"
  register: "ifup_result"
  changed_when: "ifup_result.stdout != 'UNCHANGED'"
  with_items: "cluster_deployment_names"

- name: "create deployment alias bridge network interface"
  action:
    module: "template"
    src: "cluster-app-interface-bridge"
    dest: "/etc/network/interfaces.d/{{ deployment_aliases [item].bridge_name }}.cfg"
  sudo: "yes"
  with_items: "cluster_deployment_alias_names"

- name: "start deployment alias network bridge"
  shell:

    set -e

    if ifquery --state {{ deployment_aliases [item].bridge_name }} >/dev/null; then
      echo "UNCHANGED";
      exit;
    fi

    ifup {{ deployment_aliases [item].bridge_name }};

  sudo: "yes"
  register: "ifup_result"
  changed_when: "ifup_result.stdout != 'UNCHANGED'"
  with_items: "cluster_deployment_alias_names"

- name: "create dummy network interface"
  action:
    module: "template"
    src: "cluster-app-interface-dummy"
    dest: "/etc/network/interfaces.d/dummy0.cfg"
  sudo: "yes"

- name: "start network dummy"
  shell:

    set -e

    if ifquery --state dummy0 >/dev/null; then
      echo "UNCHANGED";
      exit;
    fi

    ifup dummy0;

  sudo: "yes"
  register: "ifup_result"
  changed_when: "ifup_result.stdout != 'UNCHANGED'"

# ex: et ts=2 filetype=yaml
