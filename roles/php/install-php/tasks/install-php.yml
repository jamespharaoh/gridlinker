---

- name: "install php packages"
  with_items: "{{ php_packages }}"
  sudo: "yes"
  action:

    module: "apt"
    name: "{{ item }}"

- name: "disable php upstart"
  sudo: "yes"
  args:

    executable: "/bin/bash"
    removes: "/etc/init.d/php5-fpm"

  shell:

    set -euf -o pipefail;

    stop php5-fpm;

    rm -f
      /etc/init.d/php5-fpm
      /etc/init.d/rc?.d/[KS]??php5-fpm
      /etc/init/php5-fpm.conf;

- name: "set php.state to 'installed'"
  when: "php_state == 'no'"
  update_resource:

    php.state: "installed"

# ex: et ts=2 filetype=yaml
