---

etcd_name: "{{ identity.name }}"
etcd_hostname: "{{ etcd_name }}"
etcd_hostnames: [ "{{ etcd_hostname }}" ]
etcd_ips: []

etcd_peer_hostname: "{{ etcd_hostname }}"
etcd_peer_hostnames: "{{ etcd_hostnames }}"
etcd_peer_ips: "{{ etcd_ips }}"
etcd_peer_protocol: "{{ 'https' if etcd_secured == 'yes' else 'http' }}"
etcd_peer_port: "2380"
etcd_peer_url: "{{ etcd_peer_protocol }}://{{ etcd_peer_hostname }}:{{ etcd_peer_port }}"
etcd_peer_urls: "{{ etcd_peer_hostnames
  | prepend_list (etcd_peer_protocol + '://')
  | append_list (':' + etcd_peer_port)
}}"

etcd_client_hostname: "{{ etcd_hostname }}"
etcd_client_hostnames: "{{ etcd_hostnames }}"
etcd_client_ips: "{{ etcd_ips }}"
etcd_client_protocol: "{{ 'https' if etcd_secured == 'yes' else 'http' }}"
etcd_client_port: "2379"
etcd_client_url: "{{ etcd_client_protocol }}://{{ etcd_client_hostname }}:{{ etcd_client_port }}"
etcd_client_urls: "{{ etcd_client_hostnames
  | prepend_list (etcd_client_protocol + '://')
  | append_list (':' + etcd_client_port)
}}"

etcd_user_email: "{{ identity.name }}" 
etcd_user_emails: [ "{{ identity.name }}" ]

etcd_initial_cluster: "{{ etcd_name }}={{ etcd_peer_url }}"
etcd_initial_cluster_state: "new"
etcd_initial_advertise_peer_urls: "{{ etcd_peer_urls }}"

etcd_listen_peer_urls: "{{ [ etcd_peer_url ] }}"
etcd_listen_client_urls: "{{ [ etcd_client_url ] }}"
etcd_advertise_client_urls: "{{ etcd_client_urls }}"

etcd_snapshot_count: "10000"
etcd_heartbeat_interval: "100"
etcd_election_timeout: "1000"

etcd_installed_version: "no"
etcd_needs_restart: "no"

etcd_client_authority: "{{ SHORT_NAME }}-etcd-clients"
etcd_client_common_name: "{{ SHORT_TITLE }} Etcd Clients CA"
etcd_client_ca_certificate: "/authority/{{ etcd_client_authority }}/certificate"

etcd_peer_authority: "{{ SHORT_NAME }}-etcd-peers"
etcd_peer_common_name: "{{ SHORT_TITLE }} Etcd Peers CA"
etcd_peer_ca_certificate: "/authority/{{ etcd_peer_authority }}/certificate"

etcd_directories:

  - path: "/etc/etcd"
    mode: "0755"

etcd_security_config:

  - source: "{{ etcd_peer_ca_certificate }}"
    target: "peer-ca.cert"
    mode: "0644"

  - source: "{{ etcd_peer_certificate }}"
    target: "peer-{{ etcd_name }}.cert"
    mode: "0644"

  - source: "{{ etcd_peer_private_key }}"
    target: "peer-{{ etcd_name }}.key"
    mode: "0600"

  - source: "{{ etcd_client_ca_certificate }}"
    target: "client-ca.cert"
    mode: "0644"

  - source: "{{ etcd_client_certificate }}"
    target: "client-{{ etcd_name }}.cert"
    mode: "0644"

  - source: "{{ etcd_client_private_key }}"
    target: "client-{{ etcd_name }}.key"
    mode: "0600"

# ex: et ts=2 filetype=yaml# ex: et ts=2 filetype=yaml
