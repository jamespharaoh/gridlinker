---

- name: "install etcd"
  when: "etcd_installed_version != etcd_version"
  sudo: "yes"
  args:
    executable: "/bin/bash"
  shell:

    set -euf -o pipefail;

    rm -rf "{{ etcd_temp }}";
    mkdir "{{ etcd_temp }}";
    cd "{{ etcd_temp }}";

    wget --quiet "{{ etcd_url }}";

    tar -xzf "{{ etcd_archive }}";

    rsync --archive --delete
      "{{ etcd_directory }}/"
      "{{ etcd_target }}/";

    rm -rf "{{ etcd_temp }}";

- name: "set etcd.state to 'installed'"
  when: "etcd_state == 'no'"
  tags: [ "etcd", "install-etcd" ]
  update_resource:

    etcd.state: "installed"

- name: "set etcd.installed_version"
  when: "etcd_installed_version != etcd_version"
  tags: [ "etcd", "install-etcd" ]
  update_resource:

    etcd.installed_version: "{{ etcd_version }}"

# ex: et ts=2 filetype=yaml
