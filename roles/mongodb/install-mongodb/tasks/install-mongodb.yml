---

- name: "install mongodb"
  args:

    executable: "/bin/bash"
    creates: "{{ mongodb_flag }}"

  become: "yes"
  shell:

    set -euf -o pipefail;

    rm -rf {{ mongodb_tmp }};
    mkdir {{ mongodb_tmp }};
    cd {{ mongodb_tmp }};

    wget {{ mongodb_url }};

    rm -rf {{ mongodb_name }};
    tar --extract --gzip --file {{ mongodb_archive }};

    rsync --archive --delete {{ mongodb_name }}/ {{ mongodb_target }}/;

    rm -rf {{ mongodb_tmp }};
    touch {{ mongodb_flag }};

- name: "setup mongodb alternatives"
  with_items: "{{ mongodb_binaries }}"
  become: "yes"
  action:

    module: "alternatives"
    name: "{{ item }}"
    link: "/usr/bin/{{ item }}"
    path: "{{ mongodb_target }}/bin/{{ item }}"
    force: "yes"

- name: "install mongodb upstart"
  become: "yes"
  action:

    module: "template"
    dest: "/etc/init/mongodb.conf"
    src: "mongodb-upstart"

# ex: et ts=2 filetype=yaml
