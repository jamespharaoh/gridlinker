---

- name: "destroy lxc container"
  action: shell

    set -e;

    source $HOME/wistla-devops/misc/locking ansible;
    exlock;

    lxc-info
      --name {{ inventory_hostname }}
      >/dev/null

    if test $? != 0; then
      echo "UNCHANGED";
      return;
    fi;

    lxc-destroy
      --name {{ inventory_hostname }};

  args:
    executable: "/bin/bash"
  delegate_to: "localhost"
  sudo: "yes"
  sudo_user: "root"
  register: destroy_result
  changed_when: destroy_result.stdout != 'UNCHANGED'

# ex: et ts=2 filetype=yaml
