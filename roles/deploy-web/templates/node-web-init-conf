description "wistla webs"

start on runlevel [2345]
stop on runlevel [!2345]

respawn
respawn limit unlimited

env HOME=/home/ubuntu

script

	cd /home/ubuntu/wistla-web

	setuid ubuntu \
	mkdir --parents /shared/log

	setuid ubuntu \
	touch /shared/log/wistla-web.log

	exec >> /shared/log/wistla-web.log
	exec 2>> /shared/log/wistla-web.log

	exec setuid ubuntu \
{% if debug == 'yes' %}
	node-debug \
	--debug-brk=0 \
{% else %}
	stdbuf -oL -eL \
	node \
	--trace_gc \
	--expose_gc \
	--min_semi_space_size={{ 4 }} \
	--max_semi_space_size={{ 32 }} \
	--max_old_space_size={{ (node_memory.api | int) - 128 }} \
	--max_executable_size={{ 32 }} \
{% endif %}
	keystone.js

end script

post-stop exec sleep 2
