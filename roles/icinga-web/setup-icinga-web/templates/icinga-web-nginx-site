{% set icinga_web_base = '/opt/icinga-web-' + icinga_web_version %}
{% set icinga_web_public = icinga_web_base + '/public' %}

server {

	listen 80;

	server_name {{ icinga_web_hostname }};

	location ~ ^/icingaweb2/index\.php(.*)$ {

		fastcgi_pass unix:/var/run/php5-fpm.sock;
		fastcgi_index index.php;

		include fastcgi_params;

		fastcgi_param SCRIPT_FILENAME {{ icinga_web_public }}/index.php;
		fastcgi_param ICINGAWEB_CONFIGDIR /etc/icingaweb2;
		fastcgi_param REMOTE_USER $remote_user;

	}

	location ~ ^/icingaweb2(.+)? {

		alias {{ icinga_web_public }};

		index index.php;
		try_files $1 $uri $uri/ /icingaweb2/index.php$is_args$args;

	}

}
