---

- name: "install kernel"
  become: "yes"
  action:

    module: "apt"
    name: "{{ (
      'linux-generic-lts-wily'
    ) if cluster_name in [ 'production', 'production-2' ] else (
      'linux-generic-lts-xenial'
    ) }}"

  register: "install_kernel_result"

- name: "reboot"
  async: "0"
  poll: "0"
  ignore_errors: "true"
  when: "install_kernel_result.changed"
  tags: "reboot"
  become: "yes"
  command: "shutdown -r now"

- name: "waiting for server to reboot"
  when: "install_kernel_result.changed"
  tags: "reboot"
  connection: "local"
  action:

    module: "wait_for"
    host: "{{ ansible_ssh_host }}"
    state: "started"
    port: "22"
    delay: "10"

# ex: et ts=2 filetype=yaml
