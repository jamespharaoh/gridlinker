{%-
	for other_deployment_name, other_deployment in deployments.items ()
	if (
		'bridge_network' in other_deployment
	) and (
		inventory_hostname in groups.vagrant
		or other_deployment.supercluster_name == supercluster_name
		or (
			inventory_hostname == 'wistla-ops-jenkins'
			and other_deployment.name | starts_with ('jenkins-')
		)
	)
-%}

	{%- print '\n# ---------- deployment ', other_deployment_name, '\n\n' -%}

	{%- if other_deployment.cluster_name in [ 'dev', 'jenkins' ] -%}

		{%- print [
			other_deployment.bridge_network + '.0.1',
			'wistla-' + other_deployment_name + '-dev',
			other_deployment.main_domain,
		] | join (' '), '\n' -%}

		{%- for node_type in [
			'api',
			'api2',
			'browser',
			'db-daemon',
			'kafka',
			'load',
			'media',
			'mongo',
			'notifications',
			'postgresql',
			'postgresql-cache',
			'postgresql-main',
			'rabbit',
			'web',
		] -%}
		{%- for node_index in range (4) -%}

			{%- print [
				[
					other_deployment.bridge_network,
					node_index | string,
					node_type_indices [node_type] | string,
				] | join ('.'),
				[
					other_deployment_name,
					node_type,
					node_index | string,
				] | join ('-'),
				[
					node_type + '-' + node_index | string,
					other_deployment.main_domain,
				] | join ('.'),
			] | join (' ') + '\n' -%}

			{%- if node_type == 'load' -%}

				{%- print [
					[
						other_deployment.bridge_network,
						node_index | string,
						node_type_indices [node_type] | string,
					] | join ('.'),
				] | union (
					[ 'api', 'web', 'short', 'assets' ]
					| append_list ('.' + [
						other_deployment_name,
						node_type,
						node_index | string,
					] | join ('-'))
				) | join (' ') + '\n' -%}

			{%- endif -%}

		{%- endfor -%}
		{%- endfor -%}

		{%- if other_deployment_name == deployment_name
			or inventory_hostname == 'wistla-ops-jenkins' -%}

			{%- print '\n' -%}

			{%- for node_index in range (4) -%}

				{%- print [
					[
						other_deployment.bridge_network,
						node_index,
						node_type_indices.load,
					] | join ('.'),
					other_deployment.main_domain,
					other_deployment.api_domain,
					other_deployment.web_domain,
					other_deployment.assets_domain,
					other_deployment.admin_domain,
					other_deployment.short_domain,
				] | join (' ') + '\n' -%}

			{%- endfor -%}

		{%- endif -%}

	{%- elif other_deployment.type == 'alias' -%}

		{%- for node_type in [
			'api',
			'api2',
			'browser',
			'load',
			'web',
		] -%}
		{%- for node_zone in [ 'a', 'b', 'c' ] -%}
		{%- for node_index in range (256) -%}

			{%- print [
				[
					other_deployment.bridge_network,
					node_index | string,
					(cluster_zone_indices [node_zone] * 64
						+ node_type_indices [node_type]) | string,
				] | join ('.'),
				[
					other_deployment_name,
					node_type,
					node_zone,
					node_index | string,
				] | join ('-'),
				[
					node_type + '-' + node_zone + '-' + node_index | string,
					other_deployment.main_domain,
				] | join ('.'),
			] | join (' ') + '\n' -%}

			{%- if node_type == 'load' -%}

				{%- print [
					[
						other_deployment.bridge_network,
						node_index | string,
						(cluster_zone_indices [node_zone] * 64
							+ node_type_indices [node_type]) | string,
					] | join ('.'),
				] | union (
					[ 'api', 'web', 'short', 'assets' ]
					| append_list ('.' + [
						other_deployment_name,
						node_type,
						node_zone,
						node_index | string,
					] | join ('-'))
				) | join (' ') + '\n' -%}

			{%- endif -%}

		{%- endfor -%}
		{%- endfor -%}
		{%- endfor -%}

	{%- elif other_deployment.type == 'alias2' -%}

		{%- for node_type in [
			'api2',
			'browser',
			'load',
		] -%}
		{%- for node_zone in [ 'a', 'b', 'c' ] -%}
		{%- for node_index in range (256) -%}

			{%- print [
				[
					other_deployment.bridge_network,
					node_index | string,
					(cluster_zone_indices [node_zone] * 64
						+ node_type_indices [node_type]) | string,
				] | join ('.'),
				[
					other_deployment_name,
					node_type,
					node_zone,
					node_index | string,
				] | join ('-'),
				[
					node_type + '-' + node_zone + '-' + node_index | string,
					other_deployment.main_domain,
				] | join ('.'),
			] | join (' ') + '\n' -%}

			{%- if node_type == 'load' -%}

				{%- print [
					[
						other_deployment.bridge_network,
						node_index | string,
						(cluster_zone_indices [node_zone] * 64
							+ node_type_indices [node_type]) | string,
					] | join ('.'),
				] | union (
					[ 'api', 'web', 'short', 'assets' ]
					| append_list ('.' + [
						other_deployment_name,
						node_type,
						node_zone,
						node_index | string,
					] | join ('-'))
				) | join (' ') + '\n' -%}

			{%- endif -%}

		{%- endfor -%}
		{%- endfor -%}
		{%- endfor -%}

	{%- elif other_deployment.type == 'shared' -%}

		{%- for node_type in [
			'kafka',
			'mongo',
			'postgresql',
			'postgresql-cache',
			'postgresql-main',
			'rabbit',
		] -%}
		{%- for node_zone in [ 'a', 'b', 'c' ] -%}
		{%- for node_index in range (256) -%}

			{%- print [
				[
					other_deployment.bridge_network,
					node_index | string,
					(cluster_zone_indices [node_zone] * 64
						+ node_type_indices [node_type]) | string,
				] | join ('.'),
				[
					other_deployment_name,
					node_type,
					node_zone,
					node_index | string,
				] | join ('-'),
				[
					node_type + '-' + node_zone + '-' + node_index | string,
					other_deployment.main_domain,
				] | join ('.'),
			] | join (' ') + '\n' -%}

		{%- endfor -%}
		{%- endfor -%}
		{%- endfor -%}

	{%- elif other_deployment.type == 'shared2' -%}

		{%- for node_type in [
			'kafka',
			'mongo',
			'postgresql',
			'postgresql-cache',
			'postgresql-main',
			'rabbit',
		] -%}
		{%- for node_zone in [ 'a', 'b', 'c' ] -%}
		{%- for node_index in range (256) -%}

			{%- print [
				[
					other_deployment.bridge_network,
					node_index | string,
					(cluster_zone_indices [node_zone] * 64
						+ node_type_indices [node_type]) | string,
				] | join ('.'),
				[
					other_deployment_name,
					node_type,
					node_zone,
					node_index | string,
				] | join ('-'),
				[
					node_type + '-' + node_zone + '-' + node_index | string,
					other_deployment.main_domain,
				] | join ('.'),
			] | join (' ') + '\n' -%}

		{%- endfor -%}
		{%- endfor -%}
		{%- endfor -%}

	{%- elif other_deployment.type == 'simple' -%}

		{%- for node_type in [
			'api',
			'api2',
			'browser',
			'db-daemon',
			'kafka',
			'load',
			'media',
			'mongo',
			'notifications',
			'postgresql',
			'postgresql-cache',
			'postgresql-main',
			'rabbit',
			'web',
		] -%}
		{%- for node_zone in [ 'a', 'b', 'c' ] -%}
		{%- for node_index in range (256) -%}

			{%- print [
				[
					other_deployment.bridge_network,
					node_index | string,
					(cluster_zone_indices [node_zone] * 64
						+ node_type_indices [node_type]) | string,
				] | join ('.'),
				[
					other_deployment_name,
					node_type,
					node_zone,
					node_index | string,
				] | join ('-'),
				[
					node_type + '-' + node_zone + '-' + node_index | string,
					other_deployment.main_domain,
				] | join ('.'),
			] | join (' ') + '\n' -%}

			{%- if node_type == 'load' -%}

				{%- print [
					[
						other_deployment.bridge_network,
						node_index | string,
						(cluster_zone_indices [node_zone] * 64
							+ node_type_indices [node_type]) | string,
					] | join ('.'),
				] | union (
					[ 'api', 'web', 'short', 'assets' ]
					| append_list ('.' + [
						other_deployment_name,
						node_type,
						node_zone,
						node_index | string,
					] | join ('-'))
				) | join (' ') + '\n' -%}

			{%- endif -%}

		{%- endfor -%}
		{%- endfor -%}
		{%- endfor -%}

	{%- elif other_deployment.type == 'simple2' -%}

		{%- for node_type in [
			'api2',
			'browser',
			'db-daemon',
			'kafka',
			'load',
			'media',
			'mongo',
			'notifications',
			'postgresql',
			'postgresql-cache',
			'postgresql-main',
			'rabbit',
		] -%}
		{%- for node_zone in [ 'a', 'b', 'c' ] -%}
		{%- for node_index in range (256) -%}

			{%- print [
				[
					other_deployment.bridge_network,
					node_index | string,
					(cluster_zone_indices [node_zone] * 64
						+ node_type_indices [node_type]) | string,
				] | join ('.'),
				[
					other_deployment_name,
					node_type,
					node_zone,
					node_index | string,
				] | join ('-'),
				[
					node_type + '-' + node_zone + '-' + node_index | string,
					other_deployment.main_domain,
				] | join ('.'),
			] | join (' ') + '\n' -%}

			{%- if node_type == 'load' -%}

				{%- print [
					[
						other_deployment.bridge_network,
						node_index | string,
						(cluster_zone_indices [node_zone] * 64
							+ node_type_indices [node_type]) | string,
					] | join ('.'),
				] | union (
					[ 'api', 'web', 'short', 'assets' ]
					| append_list ('.' + [
						other_deployment_name,
						node_type,
						node_zone,
						node_index | string,
					] | join ('-'))
				) | join (' ') + '\n' -%}

			{%- endif -%}

		{%- endfor -%}
		{%- endfor -%}
		{%- endfor -%}

	{%- endif -%}

{%- endfor -%}
