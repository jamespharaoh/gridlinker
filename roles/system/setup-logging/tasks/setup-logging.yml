---

- name: "setup logging vmstat script"
  register: "setup_logging_vmstat_script_result"
  become: "yes"
  action:

    module: "copy"
    dest: "/etc/vmstat-logging-script"
    src: "logging-vmstat-script"
    mode: "0755"

# ---------- upstart

- name: "setup logging vmstat upstart config"
  when: "system_init == 'upstart'"
  register: "setup_logging_vmstat_upstart_config_result"
  become: "yes"
  action:

    module: "template"
    dest: "/etc/init/vmstat.conf"
    src: "logging-vmstat-upstart"

- name: "setup logging vmstat upstart reload configuration"
  when: "setup_logging_vmstat_upstart_config_result | changed"
  command: "initctl reload-configuration"

- name: "setup logging vmstat upstart stop"
  when: "
    (
      system_init == 'upstart'
    ) and (
      setup_logging_vmstat_script_result | changed
      or setup_logging_vmstat_upstart_config_result | changed
    )
  "
  become: "yes"
  action:

    module: "service"
    name: "vmstat"
    state: "stopped"

- name: "setup logging vmstat upstart start"
  when: "system_init == 'upstart'"
  become: "yes"
  action:

    module: "service"
    name: "vmstat"
    state: "started"

# ---------- systemd

- name: "setup logging vmstat systemd config"
  when: "system_init == 'systemd'"
  register: "setup_logging_vmstat_systemd_config_result"
  become: "yes"
  action:

    module: "template"
    dest: "/etc/systemd/system/vmstat.service"
    src: "logging-vmstat-systemd"

- name: "setup logging vmstat systemd daemon reload"
  when: "setup_logging_vmstat_systemd_config_result | changed"
  become: "yes"
  command: "systemctl daemon-reload"

- name: "setup logging vmstat systemd stop"
  when: "
    (
      system_init == 'systemd'
    ) and (
      setup_logging_vmstat_script_result | changed
      or setup_logging_vmstat_systemd_config_result | changed
    )
  "
  become: "yes"
  action:

    module: "service"
    name: "vmstat"
    state: "stopped"

- name: "setup logging vmstat systemd start"
  when: "system_init == 'systemd'"
  become: "yes"
  action:

    module: "service"
    name: "vmstat"
    state: "started"
    enabled: "yes"

# ---------- logrotate

- name: "install vmstat logrotate"
  become: "yes"
  action:

    module: "template"
    dest: "/etc/logrotate.d/vmstat"
    src: "logging-vmstat-logrotate"

# ex: et ts=2 filetype=yaml
