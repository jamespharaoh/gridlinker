{{ ansible_warning ['#'] }}

github.com {{ ssh_host_keys.general.github | join }}

{% for host_name in groups ['cluster-host'] -%}

	{%- set host = hostvars [host_name] -%}
	{%- set instance_cluster = host.instance_cluster -%}
	{%- set instance_type = host.instance_type -%}
	{%- set instance_zone = host.instance_zone -%}
	{%- set instance_index = host.instance_index | string -%}

	{%- if instance_cluster in ssh_host_keys -%}
	{%- if instance_type in ssh_host_keys [instance_cluster] -%}

		{%- if instance_zone + '-' + instance_index in ssh_host_keys [instance_cluster] [instance_type] -%}

			{%- print [
				host_name,
				ssh_host_keys [instance_cluster] [instance_type] [instance_zone + '-' + instance_index] | join (''),
			] | join (' ') + '\n' -%}

		{%- elif instance_zone in ssh_host_keys [instance_cluster] [instance_type] -%}

			{%- print [
				host_name,
				ssh_host_keys [instance_cluster] [instance_type] [instance_zone] | join (''),
			] | join (' ') + '\n' -%}

		{%- else -%}

			{%- print '# ' + host_name + ' (no host key)\n' -%}

		{%- endif -%}

	{%- endif -%}
	{%- endif -%}

{%- endfor %}
