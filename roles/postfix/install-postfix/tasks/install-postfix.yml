---

- include_vars: "{{ HOME }}/security/amazon/{{ supercluster_name }}.yml"

- name: "install postfix"
  with_items:

    - "postfix"

  become: "yes"
  action:

    module: "apt"
    name: "{{ item }}"

- name: "create postfix main config"
  notify: "restart postfix"
  become: "yes"
  action:

    module: "template"
    dest: "/etc/postfix/main.cf"
    src: "install-postfix-main"

- name: "create postfix sasl passwords"
  notify: "rehash sasl passwords"
  become: "yes"
  action:

    module: "template"
    dest: "/etc/postfix/sasl_passwd"
    src: "install-postfix-sasl-passwd"
    mode: "0600"

- name: "create postfix relayhost map"
  become: "yes"
  notify: "rehash relayhost map"
  action:

    module: "template"
    dest: "/etc/postfix/relayhost_map"
    src: "install-postfix-relayhost-map"
    mode: "0644"

- name: "create postfix aliases"
  become: "yes"
  notify: "rehash aliases"
  action:

    module: "template"
    dest: "/etc/aliases"
    src: "install-postfix-aliases"
    mode: "0644"

- meta: "flush_handlers"

# ex: et ts=2 filetype=yaml
