---

- include_vars: "data/ssh-user-keys"

- name: "add authorized keys"
  action:
    module: "authorized_key"
    user: "ubuntu"
    key: "{{ [
      ssh_user_keys [amazon_key_name].type,
      ssh_user_keys [amazon_key_name].data | join (''),
      amazon_key_name,
    ] | join (' ') }}"

- name: "remove authorized keys"
  action:
    module: "authorized_key"
    user: "ubuntu"
    state: "absent"
    key: "{{ [
      ssh_user_keys [amazon_key_name + '-old'].type,
      ssh_user_keys [amazon_key_name + '-old'].data | join (''),
    ] | join (' ') }}"

# TODO use exclusive option in ansible 1.9 when available

# ex: et ts=2 filetype=yaml
