# {{ ansible_managed }}

<VirtualHost *:80>

	ServerName {{ item.main_domain }}
	ServerAlias {{ item.main_domain }}.datingnode.com

	ServerAlias {{ item.main_domain }}.{{ cluster.domain_suffix }}
	ServerAlias {{ item.main_domain }}.datingnode.com.{{ cluster.domain_suffix }}

{% for alias in item.main_alias %}

	ServerAlias {{ alias }}
	ServerAlias {{ alias }}.{{ cluster.domain_suffix }}

{% endfor %}

	ServerAdmin staging@rocketware.co.uk

	SetEnvIf Remote_Addr ^ SERVICE_DOMAIN={{ item.main_domain }}

	DocumentRoot {{platform_super_dir}}

	<Directory {{platform_super_dir}}>
		Options FollowSymLinks
		AllowOverride none
		Order allow,deny
		allow from all

		Include {{ platform_super_dir }}config/apache2.2-vhost-rules-service.conf
	</Directory>

	<Location />

		<IfModule mod_filter.c>
		<IfModule mod_deflate.c>
		AddOutputFilterByType DEFLATE application/atom+xml \
			application/javascript \
			application/json \
			application/rss+xml \
			application/vnd.ms-fontobject \
			application/x-font-ttf \
			application/xhtml+xml \
			application/xml \
			font/opentype \
			image/svg+xml \
			image/x-icon \
			text/css \
			text/html \
			text/plain \
			text/x-component \
			text/xml
		</IfModule>
		</IfModule>

	</Location>

	CustomLog {{ platform_log_dir }}service-apache-access.log combined
	ErrorLog {{ platform_log_dir }}service-apache-error.log
	LogLevel warn

	RewriteEngine On
#	RewriteCond %{HTTP_HOST} !^www\.
#	RewriteRule ^(.*)$ http://www.%{HTTP_HOST}$1 [R=301,L]


</VirtualHost>
