description "wistla api"

start on runlevel [2345]
stop on runlevel [!2345]

respawn
respawn limit unlimited

env HOME=/home/ubuntu

script

	cd /home/ubuntu/wistla-api

	setuid ubuntu \
	mkdir --parents /shared/log

	setuid ubuntu \
	touch /shared/log/wistla-api.log

	exec >> /shared/log/wistla-api.log
	exec 2>> /shared/log/wistla-api.log

	exec setuid ubuntu \
{% if debug == 'yes' %}
	node-debug \
	--debug-brk=0 \
{% else %}
	stdbuf -oL -eL \
	nodejs \
	--trace_gc \
{% endif %}
	server.js

end script

post-stop exec sleep 2
