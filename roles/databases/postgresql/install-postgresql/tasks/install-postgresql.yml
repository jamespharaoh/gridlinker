---

- name: "install postgresql packages"
  sudo: "yes"
  with_items:

    - "postgresql-9.3"

  action:

    module: "apt"
    name: "{{ item }}"

- name: "disable postgresql sysv init"
  changed_when: "postgresql_sysv_result.stdout != 'UNCHANGED'"
  register: "postgresql_sysv_result"
  sudo: "yes"
  shell:

    test -e /etc/init.d/postgresql || { echo UNCHANGED; exit 0; };
    service postgresql stop;
    rm -f /etc/init.d/postgresql /etc/init.d/rc?.d/[KS]??postgresql;

- name: "set postgresql.state to 'installed'"
  when: "postgresql_state == ''"
  update_resource:

    postgresql.state: "installed"

- name: "create postgresql user 'ubuntu'"
  sudo: "yes"
  sudo_user: "postgres"
  action:

    module: "postgresql_user"
    name: "ubuntu"

    role_attr_flags: "SUPERUSER"

    login_unix_socket: "/var/run/postgresql"

# ex: et ts=2 filetype=yaml
