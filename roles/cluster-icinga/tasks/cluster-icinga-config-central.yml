---

- name: "create icinga zone directories"
  action:
    module: "file"
    path: "/etc/icinga2/zones.d/{{ item }}"
    state: "directory"
  sudo: "yes"
  with_items:
    - "global-templates"
    - "wistla-ops"
    - "wistla-production"
    - "wistla-staging"

- name: "create icinga zone configs"
  action:
    module: "template"
    src: "{{ item [1].src }}"
    dest: "/etc/icinga2/zones.d/wistla-{{ item [0] }}/{{ item [1].dest }}"
  sudo: "yes"
  with_nested:

    - "clusters"

    - - src: "icinga-hosts-config"
        dest: "hosts.conf"

  sudo: "yes"
  notify: "restart icinga"

- name: "create icinga template configs"
  action:
    module: "template"
    src: "{{ item.src }}"
    dest: "/etc/icinga2/zones.d/global-templates/{{ item.dest }}"
  sudo: "yes"
  with_items:

    - src: "icinga-templates-config"
      dest: "templates.conf"

  sudo: "yes"
  notify: "restart icinga"

# ex: et ts=2 filetype=yaml
