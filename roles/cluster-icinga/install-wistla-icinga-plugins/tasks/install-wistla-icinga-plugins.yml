---

- name: "create wistla icinga plugins directory"
  become: "yes"
  action:

    module: "file"
    path: "/etc/icinga2/plugins"
    state: "directory"

- name: "install wistla icinga plugins"
  with_items: "{{ wistla_icinga_plugins }}"
  become: "yes"
  action:

    module: "copy"
    dest: "/etc/icinga2/plugins/{{ item.name }}"
    src: "{{ item.name }}"
    mode: "0755"

- name: "install wbs-monitoring plugins"
  become: "yes"
  args:

    creates: "/opt/wbs-monitoring-1.3.0"
    executable: "/bin/bash"

  shell:

    set -euf -o pipefail;

    rm -rf /tmp/wbs-monitoring-install;
    mkdir /tmp/wbs-monitoring-install;
    cd /tmp/wbs-monitoring-install;

    wget https://dist.wellbehavedsoftware.com/wbs-monitoring/wbs-monitoring-1.3.0.tar.xz;
    tar --extract --xz --file wbs-monitoring-1.3.0.tar.xz;

    rsync --recursive
      "wbs-monitoring-1.3.0/"
      "/opt/wbs-monitoring-1.3.0/";

    cd /;
    rm -rf /tmp/wbs-monitoring-install;

- name: "link wbs-monitoring"
  become: "yes"
  action:

    module: "file"
    path: "/opt/wbs-monitoring"
    state: "link"

    src: "wbs-monitoring-1.3.0"

# ex: et ts=2 filetype=yaml
