{% set vpn_net = cluster.vpn_network + '.' + vpn_groups [zon] %}

# server

tls-server
proto udp
port 1194
keepalive 5 20
mode server
persist-key
persist-tun
status wistla-{{ cluster_name }}-vpn.log

client-config-dir clients
client-connect client-connect-script
client-disconnect client-disconnect-script

# network

dev tun
topology subnet
tun-mtu 1500

ifconfig {{ vpn_net }}.1 255.255.255.0

push "route-gateway {{ vpn_net }}.1"

push "route {{ cluster.cluster_network }}.0.0 255.255.0.0 {{ vpn_net }}.1"
push "route {{ cluster.vpn_network }}.0.0 255.255.0.0 {{ vpn_net }}.1"

{% for cluster_deployment_name in cluster.deployment_names %}
{% set cluster_deployment = deployments [cluster_deployment_name] %}
push "route {{ cluster_deployment.bridge_network }}.0.0 255.255.0.0 {{ vpn_net }}.1"
{% endfor %}

{% if cluster_name == 'ops' %}
{% for dev_deployment_name in dev_deployment_names %}
{% set dev_deployment = deployments [dev_deployment_name] %}
push "route {{ dev_deployment.bridge_network }}.0.0 255.255.0.0 {{ vpn_net }}.1"
{% endfor %}
{% endif %}

client-to-client

# security

dh wistla-dh.pem

ca wistla-ca.cert
#crl-verify wistla-ca.crl

cert wistla-{{ cluster_name }}-vpn.cert
key wistla-{{ cluster_name }}-vpn.key
