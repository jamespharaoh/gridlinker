---

- name: "install mysql config"
  sudo: "yes"
  notify: "set mysql.needs_restart to 'yes'"
  action:

    module: "template"
    src: "{{ item.template }}"
    dest: "{{ item.target }}"

  with_items:

    - template: "mysql-global-config"
      target: "/etc/mysql/my.cnf"

- name: "create global mysql root user"
  when: "
    (
      mysql_replication == 'no'
      or identity.name == mysql_master
    ) and mysql_state in [ 'no', 'enabled' ]
  "
  action:

    module: "mysql_user"
    name: "root"
    password: "{{ mysql_root_password }}"
    priv: "*.*:ALL,GRANT"
    host: "%"

- name: "set mysql.state to 'enabled'"
  when: "mysql_state == 'installed'"
  update_resource:

    mysql.state: "enabled"

# ex: et ts=2 filetype=yaml
