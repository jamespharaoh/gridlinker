{{ ansible_warning ['#'] }}

local all all trust
host all all {{ cluster.cluster_network }}.0.0/16 trust

{% for other_deployment in cluster.deployment_names %}
{% set other_deployment = deployments [other_deployment] %}
{% if (
	other_deployment.type in [ 'alias', 'alias2' ]
	and other_deployment.alias == cluster_deployment.name
) %}

# {{ other_deployment.name }}
host all all {{ other_deployment.bridge_network }}.0.0/16 trust

{% elif other_deployment.name == cluster_deployment.name %}

# {{ other_deployment.name }}
host all all {{ other_deployment.bridge_network }}.0.0/16 trust
host replication all {{ other_deployment.bridge_network }}.0.0/16 trust

{% endif %}
{% endfor %}

{% for vpn_client in vpn_clients %}
{% for vpn_network in cluster.vpn_networks | values %}
host all all {{ vpn_network }}.{{ vpn_client.vpn_ip }}/32 trust
{% endfor %}
{% endfor %}
