{{ ansible_warning ['#'] }}

{% set kafka = cluster_deployment.kafka %}

broker.id = -1

# ---------- networking

# The number of threads handling network requests
num.network.threads = {{ kafka.num_network_threads }}

# The number of threads doing disk I/O
num.io.threads = {{ kafka.num_io_threads }}

# The send buffer (SO_SNDBUF) used by the socket server
socket.send.buffer.bytes = {{ kafka.socket_send_buffer_bytes }}

# The receive buffer (SO_RCVBUF) used by the socket server
socket.receive.buffer.bytes = {{ kafka.socket_receive_buffer_bytes }}

# The maximum size of a request that the socket server will accept (protection against OOM)
socket.request.max.bytes = {{ kafka.socket_request_max_bytes }}

# ---------- journal logging

log.dirs = /var/lib/kafka/logs
# The default number of log partitions per topic. More partitions allow greater
# parallelism for consumption, but this will also result in more files across
# the brokers.
num.partitions = {{ kafka.num_partitions }}
num.recovery.threads.per.data.dir = {{ kafka.num_recovery_threads_per_data_dir }}

log.retention.hours = {{ kafka.log_retention_hours }}
log.segment.bytes = {{ kafka.log_segment_bytes }}
log.retention.check.interval.ms = {{ kafka.log_retention_check_interval_ms }}

# ---------- zookeeper

zookeeper.connect = {{ [
	(
		[ 'a', 'b', 'c' ]
		| prepend_list ('wistla-' + cluster_name + '-admin-')
		| append_list (':2181')
	) | join (','),
	'/' + cluster_deployment_name + '/kafka',
] | join }}
zookeeper.connection.timeout.ms = {{ kafka.zookeeper_connection_timeout_ms }}

# ---------- kafka

# The port the socket server listens on
port=9092

# allow deletion of topics, might want to not enable this in prod, I don't know yet
delete.topic.enable=true

# allow topics to be created outside of the kafka CLI, i.e. from node
auto.create.topics.enable=true

# resolve offsetOutOfRange errors by automatically resetting the offset to the smallest offset
auto.offset.reset=smallest

# ex: noet ts=4
