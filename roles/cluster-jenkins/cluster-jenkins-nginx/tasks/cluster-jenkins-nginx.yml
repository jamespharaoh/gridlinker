---

- name: "cluster jenkins nginx sites"
  with_items:

    - target: "/etc/nginx/sites/jenkins.conf"
      template: "cluster-jenkins-nginx-site"

    - target: "/etc/nginx/sites/proxy.conf"
      template: "cluster-jenkins-nginx-proxy"

  register: "cluster_jenkins_nginx_site_result"
  become: "yes"
  action:

    module: "template"
    dest: "{{ item.target }}"
    src: "{{ item.template }}"

- name: "cluster jenkins nginx reload"
  changed_when: "cluster_jenkins_nginx_site_result | changed"
  become: "yes"
  action:

    module: "service"
    name: "nginx"
    state: "reloaded"

# ex: et ts=2 filetype=yaml
