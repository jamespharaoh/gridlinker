---

{{ ansible_warning ['#'] }}

{% set deployment_name = item %}
{% set deployment = deployments [deployment_name] %}

AWSTemplateFormatVersion: "2010-09-09"
Description: "Wistla dev dns {{ deployment_name }}"

Resources:

  HostedZone:
    Type: "AWS::Route53::HostedZone"
    Properties:
      Name: "{{ deployment.main_domain }}."

  WebRecordSet:
    Type: "AWS::Route53::RecordSet"
    Properties:
      Name: "{{ deployment.main_domain }}."
      Type: "A"
      AliasTarget:
        DNSName: "{{ cluster_admin_balancer_hosted_zone_name }}"
        HostedZoneId: "{{ cluster_admin_balancer_hosted_zone_name_id }}"
      HostedZoneId: { Ref: "HostedZone" }

  WwwWebRecordSet:
    Type: "AWS::Route53::RecordSet"
    Properties:
      Name: "www.{{ deployment.main_domain }}."
      Type: "A"
      AliasTarget:
        DNSName: "{{ cluster_admin_balancer_hosted_zone_name }}"
        HostedZoneId: "{{ cluster_admin_balancer_hosted_zone_name_id }}"
      HostedZoneId: { Ref: "HostedZone" }

  ApiRecordSet:
    Type: "AWS::Route53::RecordSet"
    Properties:
      Name: "api.{{ deployment.main_domain }}."
      Type: "A"
      AliasTarget:
        DNSName: "{{ cluster_admin_balancer_hosted_zone_name }}"
        HostedZoneId: "{{ cluster_admin_balancer_hosted_zone_name_id }}"
      HostedZoneId: { Ref: "HostedZone" }

  TestRecordSet:
    Type: "AWS::Route53::RecordSet"
    Properties:
      Name: "test.{{ deployment.main_domain }}."
      Type: "A"
      AliasTarget:
        DNSName: "{{ cluster_admin_balancer_hosted_zone_name }}"
        HostedZoneId: "{{ cluster_admin_balancer_hosted_zone_name_id }}"
      HostedZoneId: { Ref: "HostedZone" }

  AdminRecordSet:
    Type: "AWS::Route53::RecordSet"
    Properties:
      Name: "admin.{{ deployment.main_domain }}."
      Type: "A"
      AliasTarget:
        DNSName: "{{ cluster_admin_balancer_hosted_zone_name }}"
        HostedZoneId: "{{ cluster_admin_balancer_hosted_zone_name_id }}"
      HostedZoneId: { Ref: "HostedZone" }

Outputs:

  HostedZone:
    Value: { Ref: "HostedZone" }

# ex: et ts=2 filetype=yaml
