---

- name: "configure apache site {{ label }}"
  action:
    module: "template"
    src: "{{ config }}"
    dest: "/etc/apache2/sites-available/{{ prefix }}__{{ item.main_domain }}__{{ suffix }}.conf"
  sudo: "yes"
  with_items: "sites"

- name: "enable apache site {{ label }}"
  command:
    a2ensite "{{ prefix }}__{{ item.main_domain }}__{{ suffix }}"
  sudo: "yes"
  when: "item.enabled == true"
  with_items: "sites"

- name: "disable apache site {{ label }}"
  command:
    a2dissite "{{ prefix }}__{{ item.main_domain }}__{{ suffix }}"
  when: "item.enabled == false"
  with_items: "sites"

# ex: et ts=2 filetype=yaml
