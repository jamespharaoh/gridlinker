---

- name: "configure apache site {{ label }}"
  with_items: "{{ sites }}"
  become: "yes"
  action:

    module: "template"
    src: "{{ config }}"
    dest: "{{ [
      '/etc/apache2/sites-available/',
      prefix,
      '__',
      item.main_domain,
      '__',
      suffix,
      '.conf',
    ] | join }}"

- name: "enable apache site {{ label }}"
  with_items: "{{ sites }}"
  when: "item.enabled"
  become: "yes"
  command: "a2ensite {{ prefix }}__{{ item.main_domain }}__{{ suffix }}"

- name: "disable apache site {{ label }}"
  with_items: "{{ sites }}"
  when: "not item.enabled"
  command: "a2dissite {{ prefix }}__{{ item.main_domain }}__{{ suffix }}"

# ex: et ts=2 filetype=yaml
