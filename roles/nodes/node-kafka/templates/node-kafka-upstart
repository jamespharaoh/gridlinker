{{ ansible_warning ['#'] }}

description "Kafka message log server"

start on runlevel [2345]
stop on runlevel [!2345]

respawn
respawn limit unlimited

env HOME=/var/lib/kafka
env JAVA_HOME=/usr/lib/jvm/java-7-openjdk-amd64
env KAFKA_LOG4J_OPTS=-Dlog4j.configuration=file:/config/log4j.properties

chdir /opt/kafka-{{ kafka_version }}

script

	exec >> /shared/log/kafka.log 2>&1

	exec \
	setuid kafka \
	bin/kafka-server-start.sh \
	/config/server.properties

end script

post-stop exec sleep 2
