---

- name: "wait for mongo"
  wait_for:

    host: "{{ deployment_name }}-mongo-{{ fixtures_host_suffix }}"
    port: "27017"
    delay: "1"
    timeout: "60"

- name: "initialise replica set"
  args:

    creates: "{{ deployment_home }}/shared/flags/mongo-replica-set"

  shell: "{{ [
    [
      'mongo',
      '--host',
      deployment_name + '-mongo-' + fixtures_host_suffix,
      '--eval',
      '\"rs.initiate ()\"',
    ] | join (' '),
    'touch ' + deployment_home + '/shared/flags/mongo-replica-set',
  ] | join (' && ') }}"

# ex: et ts=2 filetype=yaml
