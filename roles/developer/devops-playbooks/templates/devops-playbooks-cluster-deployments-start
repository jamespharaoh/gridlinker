---

{{ ansible_warning ['#'] }}

{% for cluster_deployment in deployments | dictsort | values %}
{% if cluster_deployment.cluster_name != 'dev' %}
{% if cluster_deployment.type in [ 'simple2', 'alias2' ] %}

- hosts: "cluster-{{ cluster_deployment.cluster_name }}-app:&cluster-instance-active"
  roles:

    - role: "cluster-deployment-playbook"
      when: "amazon_instance_state == 'running'"
      tags: "{{ cluster_deployment.name }}"
      cluster_deployment_name: "{{ cluster_deployment.name }}"
      cluster_deployment_playbook_name: "node-start"

{% elif cluster_deployment.type in [ 'shared2' ] %}

- hosts: "cluster-{{ cluster_deployment.cluster_name }}-data:&cluster-instance-active"
  roles:

    - role: "cluster-deployment-playbook"
      when: "amazon_instance_state == 'running'"
      tags: "{{ cluster_deployment.name }}"
      cluster_deployment_name: "{{ cluster_deployment.name }}"
      cluster_deployment_playbook_name: "node-start"

{% endif %}
{% endif %}
{% endfor %}

# ex: et ts=2 filetype=yaml
