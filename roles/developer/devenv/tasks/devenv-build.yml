---

- name: "run build steps"
  when: "deployment_mode == 'vagrant'"
  with_items: "{{ devenv_checkouts }}"
  args:

    executable: "/bin/bash"
    chdir: "{{ deployment_home }}/{{ item.name }}"

  shell: "{{ item.build_steps | default (['true']) | join (' && ') }}"

- name: "run build steps"
  when: "deployment_mode == 'jenkins'"
  with_items: "{{ devenv_checkouts }}"
  args:

    executable: "/bin/bash"
    chdir: "{{ deployment_home }}/{{ item.name }}"

  shell: "{{ [
    'ssh 10.190.0.2 ',
    'cd ',
    lookup ('env', 'WORKSPACE'),
    '/',
    item.name,
    \" '&&' \",
    item.build_steps
      | default (['true'])
      | join (\" '&&' \"),
  ] | join }}"

# ex: et ts=2 filetype=yaml
