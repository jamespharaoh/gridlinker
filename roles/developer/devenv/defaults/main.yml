---

devenv_config_directories:

  - "config"
  - "config/api"
  - "config/api2"
  - "config/browser"
  - "config/kafka"
  - "config/load"
  - "config/media"
  - "config/mongo"
  - "config/postgresql-main"
  - "config/postgresql-cache"
  - "config/rabbit"

devenv_config_files:

  - source: "{{ HOME }}/security/apple/push-notifications/ca.cert"
    type: "api"
    target: "apple-ca.cert"

  - source: "{{ HOME }}/security/apple/push-notifications/{{ dev_apple_push_notifications_name | default ('null') }}.cert"
    type: "api"
    target: "apple-push.cert"

devenv_config_secrets:

  - source: "{{ HOME }}/security/test/google-service-account.key"
    type: "api"
    target: "google-service-account.key"

  - source: "{{ HOME }}/security/apple/push-notifications/{{ dev_apple_push_notifications_name | default ('null') }}.key"
    type: "api"
    target: "apple-push.key"

devenv_config_templates:

  # ---------- api

  - template: "devenv-wistla-api-config"
    type: "api"
    target: "config.local.js"

  - template: "devenv-wistla-api-environment"
    type: "api"
    target: "environment"

  # ---------- api2

  - template: "devenv-wistla-api2-schema-config"
    type: "api2"
    target: "wistla-db-schema-local.yaml"

  - template: "devenv-wistla-api2-server-config"
    type: "api2"
    target: "wistla-api-server-local.yaml"

  - template: "devenv-wistla-api2-environment"
    type: "api2"
    target: "environment"

  # ---------- media

  - template: "devenv-wistla-api2-server-config"
    type: "media"
    target: "wistla-media-daemon-local.yaml"

  - template: "devenv-wistla-media-environment"
    type: "media"
    target: "environment"

  # ---------- browser

  - template: "devenv-wistla-browser-config"
    type: "browser"
    target: "config.local.js"

  - template: "devenv-wistla-browser-environment"
    type: "browser"
    target: "environment"

  # ---------- load

  - template: "devenv-wistla-admin-config"
    type: "load"
    target: "wistla-admin-config.local.js"

  - template: "devenv-wistla-load-nginx-config"
    type: "load"
    target: "nginx-config"

  # ---------- postgresql-main

  - template: "devenv-postgresql-config"
    type: "postgresql-main"
    target: "postgresql.conf"
    owner: "postgres"
    group: "postgres"
    mode: "0644"

  - template: "devenv-postgresql-hba-config"
    type: "postgresql-main"
    target: "postgresql-hba.conf"
    owner: "postgres"
    group: "postgres"
    mode: "0640"

  # ---------- postgresql-cache

  - template: "devenv-postgresql-config"
    type: "postgresql-cache"
    target: "postgresql.conf"
    owner: "postgres"
    group: "postgres"
    mode: "0644"

  - template: "devenv-postgresql-hba-config"
    type: "postgresql-cache"
    target: "postgresql-hba.conf"
    owner: "postgres"
    group: "postgres"
    mode: "0640"

  # ---------- rabbit

  - template: "devenv-wistla-rabbit-erlang-cookie"
    type: "rabbit"
    target: "erlang-cookie"
    owner: "rabbitmq"
    group: "root"
    mode: "0400"

devenv_config_links:

  - dest: "wistla-api/config/apple-ca.cert"
    src: "../../config/api/apple-ca.cert"

  - dest: "wistla-api/config/apple-push.cert"
    src: "../../config/api/apple-push.cert"

  - dest: "wistla-api/config/apple-push.key"
    src: "../../config/api/apple-push.key"

  - dest: "wistla-api/config/config.local.js"
    src: "../../config/api/config.local.js"

  - dest: "wistla-api/config/config.overrides.js"
    src: "../../config/api/config.overrides.js"

  - dest: "wistla-api/config/google-service-account.key"
    src: "../../config/api/google-service-account.key"

  - dest: "wistla-api-server/config/local.yaml"
    src: "../../config/api2/wistla-api-server-local.yaml"

  - dest: "wistla-media-daemon/config/local.yaml"
    src: "../../config/media/wistla-media-daemon-local.yaml"

  - dest: "wistla-browser/config/config.local.js"
    src: "../../config/browser/config.local.js"

  - dest: "wistla-browser/config/config.overrides.js"
    src: "../../config/browser/config.overrides.js"

  - dest: "wistla-db-schema/config/local.yaml"
    src: "../../config/api2/wistla-db-schema-local.yaml"

devenv_shared_directories:

  - "shared"
  - "shared/audio"
  - "shared/cms-image"
  - "shared/flags"
  - "shared/image"
  - "shared/log"
  - "shared/user-upload"
  - "shared/video"

devenv_shared_logfiles:

  - log: "shared/log/content-common.log"
    user: "root"

  - log: "shared/log/mongodb.log"
    user: "mongodb"

  - log: "shared/log/nginx-access.log"
    user: "root"

  - log: "shared/log/nginx-error.log"
    user: "root"

  - log: "shared/log/nginx-times.log"
    user: "root"

  - log: "shared/log/postgresql-main.log"
    user: "postgres"

  - log: "shared/log/postgresql-cache.log"
    user: "postgres"

  - log: "shared/log/wistla-analytics.log"
    user: "vagrant"

  - log: "shared/log/wistla-api-server.log"
    user: "vagrant"

  - log: "shared/log/wistla-media-daemon.log"
    user: "vagrant"

  - log: "shared/log/wistla-api.log"
    user: "vagrant"

  - log: "shared/log/wistla-browser.log"
    user: "vagrant"

devenv_override_templates:

  - template: "devenv-wistla-api-overrides"
    target: "config/api/config.overrides.js"

  - template: "devenv-wistla-browser-overrides"
    target: "config/browser/config.overrides.js"

# ex: et ts=2 filetype=yaml
