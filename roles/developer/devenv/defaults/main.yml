---

devenv_config_directories:

  - "config"
  - "config/api"
  - "config/api2"
  - "config/browser"
  - "config/db-daemon"
  - "config/kafka"
  - "config/load"
  - "config/media"
  - "config/notifications"
  - "config/mongo"
  - "config/nodejs"
  - "config/nodejs-legacy"
  - "config/postgresql"
  - "config/postgresql-main"
  - "config/postgresql-cache"
  - "config/rabbit"
  - "config/web2"

devenv_config_files:

  - source: "{{ HOME }}/security/apple/push-notifications/ca.cert"
    type: "api"
    target: "apple-ca.cert"

  - source: "{{ HOME }}/security/apple/push-notifications/{{ dev_apple_push_notifications_name | default ('null') }}.cert"
    type: "api"
    target: "apple-push.cert"

devenv_config_secrets:

  - source: "{{ HOME }}/security/test/google-service-account.key"
    type: "api"
    target: "google-service-account.key"

  - source: "{{ HOME }}/security/apple/push-notifications/{{ dev_apple_push_notifications_name | default ('null') }}.key"
    type: "api"
    target: "apple-push.key"

devenv_config_templates:

  # ---------- api

  - template: "devenv-npmrc"
    type: "api"
    target: "npmrc"

  - template: "devenv-wistla-api-config"
    type: "api"
    target: "config.local.js"

  - template: "devenv-wistla-api-environment"
    type: "api"
    target: "environment"

  # ---------- api2

  - template: "devenv-npmrc"
    type: "api2"
    target: "npmrc"

  - template: "devenv-wistla-api2-schema-config"
    type: "api2"
    target: "wistla-db-schema-local.yaml"

  - template: "devenv-wistla-api2-server-config"
    type: "api2"
    target: "wistla-api-server-local.yaml"

  - template: "devenv-wistla-api2-environment"
    type: "api2"
    target: "environment"

  # ---------- db-daemon

  - template: "devenv-wistla-api2-server-config"
    type: "db-daemon"
    target: "wistla-db-daemon-local.yaml"

  - template: "devenv-wistla-db-daemon-environment"
    type: "db-daemon"
    target: "environment"

  # ---------- media

  - template: "devenv-npmrc"
    type: "media"
    target: "npmrc"

  - template: "devenv-wistla-api2-server-config"
    type: "media"
    target: "wistla-media-daemon-local.yaml"

  - template: "devenv-wistla-media-environment"
    type: "media"
    target: "environment"

  # ---------- nodejs

  - template: "devenv-npmrc"
    type: "nodejs"
    target: "npmrc"

  # ---------- nodejs legacy

  - template: "devenv-npmrc"
    type: "nodejs-legacy"
    target: "npmrc"

  # ---------- notifications

  - template: "devenv-npmrc"
    type: "notifications"
    target: "npmrc"

  - template: "devenv-wistla-api2-server-config"
    type: "notifications"
    target: "wistla-notification-daemon-local.yaml"

  - template: "devenv-wistla-notifications-environment"
    type: "notifications"
    target: "environment"

  # ---------- browser

  - template: "devenv-npmrc"
    type: "browser"
    target: "npmrc"

  - template: "devenv-wistla-browser-config"
    type: "browser"
    target: "config.local.js"

  - template: "devenv-wistla-browser-environment"
    type: "browser"
    target: "environment"

  # ---------- kafka

  - template: "devenv-kafka-server-properties"
    type: "kafka"
    target: "server.properties"

  - template: "devenv-kafka-consumer-properties"
    type: "kafka"
    target: "consumer.properties"

  - template: "devenv-kafka-log4j-properties"
    type: "kafka"
    target: "log4j.properties"

  # ---------- load

  - template: "devenv-wistla-load-nginx-config"
    type: "load"
    target: "nginx-config"

  # ---------- postgresql-main

  - template: "devenv-postgresql-config"
    type: "postgresql-main"
    target: "postgresql.conf"
    owner: "postgres"
    group: "postgres"
    mode: "0644"

  - template: "devenv-postgresql-hba-config"
    type: "postgresql-main"
    target: "postgresql-hba.conf"
    owner: "postgres"
    group: "postgres"
    mode: "0640"

  # ---------- postgresql-cache

  - template: "devenv-postgresql-config"
    type: "postgresql-cache"
    target: "postgresql.conf"
    owner: "postgres"
    group: "postgres"
    mode: "0644"

  - template: "devenv-postgresql-hba-config"
    type: "postgresql-cache"
    target: "postgresql-hba.conf"
    owner: "postgres"
    group: "postgres"
    mode: "0640"

  # ---------- rabbit

  - template: "devenv-wistla-rabbit-erlang-cookie"
    type: "rabbit"
    target: "erlang-cookie"
    owner: "rabbitmq"
    group: "root"
    mode: "0400"

devenv_config_links:

  # ---------- wistla-api

  - dest: "wistla-api/config/apple-ca.cert"
    src: "../../config/api/apple-ca.cert"
    legacy: "yes"

  - dest: "wistla-api/config/apple-push.cert"
    src: "../../config/api/apple-push.cert"
    legacy: "yes"

  - dest: "wistla-api/config/apple-push.key"
    src: "../../config/api/apple-push.key"
    legacy: "yes"

  - dest: "wistla-api/config/config.local.js"
    src: "../../config/api/config.local.js"
    legacy: "yes"

  - dest: "wistla-api/config/config.overrides.js"
    src: "../../config/api/config.overrides.js"
    legacy: "yes"

  - dest: "wistla-api/config/google-service-account.key"
    src: "../../config/api/google-service-account.key"
    legacy: "yes"

  # ---------- wistla-api-server

  - dest: "wistla-api-server/config/local.yaml"
    src: "../../config/api2/wistla-api-server-local.yaml"

  # ---------- wistla-browser

  - dest: "wistla-browser/config/config.local.js"
    src: "../../config/browser/config.local.js"
    legacy: "yes"

  - dest: "wistla-browser/config/config.overrides.js"
    src: "../../config/browser/config.overrides.js"
    legacy: "yes"

  # ---------- wistla-data-process

  - dest: "wistla-data-process/config/local.yaml"
    src: "../../config/api2/wistla-api-server-local.yaml"

  # ---------- wistla-db-schema

  - dest: "wistla-db-schema/config/local.yaml"
    src: "../../config/api2/wistla-db-schema-local.yaml"

  # ---------- wistla-media-daemon

  - dest: "wistla-media-daemon/config/local.yaml"
    src: "../../config/media/wistla-media-daemon-local.yaml"

  # ---------- wistla-notification-daemon

  - dest: "wistla-notification-daemon/config/local.yaml"
    src: "../../config/notifications/wistla-notification-daemon-local.yaml"

devenv_shared_directories:

  - directory: "shared"
    user: "{{ deployment_user }}"

  - directory: "shared/audio"
    user: "{{ deployment_user }}"

  - directory: "shared/cms-image"
    user: "{{ deployment_user }}"

  - directory: "shared/flags"
    user: "{{ deployment_user }}"

  - directory: "shared/image"
    user: "{{ deployment_user }}"

  - directory: "shared/log"
    user: "{{ deployment_user }}"

  - directory: "shared/log/kafka"
    user: "kafka"

  - directory: "shared/user-upload"
    user: "{{ deployment_user }}"

  - directory: "shared/video"
    user: "{{ deployment_user }}"

devenv_shared_logfiles:

  - log: "shared/log/content-common.log"
    user: "root"

  - log: "shared/log/mongodb.log"
    user: "mongodb"

  - log: "shared/log/nginx-access.log"
    user: "root"

  - log: "shared/log/nginx-error.log"
    user: "root"

  - log: "shared/log/nginx-times.log"
    user: "root"

  - log: "shared/log/postgresql-main.log"
    user: "postgres"

  - log: "shared/log/postgresql-cache.log"
    user: "postgres"

  - log: "shared/log/wistla-analytics.log"
    user: "{{ deployment_user }}"

  - log: "shared/log/wistla-api-server.log"
    user: "{{ deployment_user }}"

  - log: "shared/log/wistla-db-daemon.log"
    user: "{{ deployment_user }}"

  - log: "shared/log/wistla-media-daemon.log"
    user: "{{ deployment_user }}"

  - log: "shared/log/wistla-notification-daemon.log"
    user: "{{ deployment_user }}"

  - log: "shared/log/wistla-api.log"
    user: "{{ deployment_user }}"

  - log: "shared/log/wistla-browser.log"
    user: "{{ deployment_user }}"

devenv_override_templates:

  - template: "devenv-wistla-api-overrides"
    target: "config/api/config.overrides.js"

  - template: "devenv-wistla-browser-overrides"
    target: "config/browser/config.overrides.js"

# ex: et ts=2 filetype=yaml
