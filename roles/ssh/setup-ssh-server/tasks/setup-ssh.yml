---

- name: "configure ssh daemon"
  action:
    module: "template"
    src: "ssh-sshd-config"
    dest: "/etc/ssh/sshd_config"
  sudo: "yes"
  notify: "restart sshd"

- name: "create root ssh directory"
  action:
    module: "file"
    path: "/root/.ssh"
    state: "directory"
  sudo: "yes"

- name: "create root authorized keys"
  action:
    module: "template"
    src: "ssh-authorized-keys"
    dest: "/root/.ssh/authorized_keys"
  sudo: "yes"

- name: "create root private key"
  action:
    module: "copy"
    dest: "/root/.ssh/id_rsa"
    content: "{{ lookup ('etcd', ssh_root_key) }}"
    mode: "0600"
  sudo: "yes"

- name: "create ubuntu ssh directory"
  action:
    module: "file"
    path: "/home/ubuntu/.ssh"
    state: "directory"

- name: "create ubuntu authorized keys"
  action:
    module: "template"
    src: "ssh-authorized-keys"
    dest: "/home/ubuntu/.ssh/authorized_keys"

- name: "create known hosts"
  action:
    module: "template"
    dest: "/etc/ssh/ssh_known_hosts"
    src: "ssh-known-hosts"
  sudo: "yes"

# ex: et ts=2 filetype=yaml
