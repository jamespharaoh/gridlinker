description "wistla browsers"

start on runlevel [2345]
stop on runlevel [!2345]

respawn
respawn limit unlimited

env HOME=/home/ubuntu

script

	cd /home/ubuntu/wistla-browser

	setuid ubuntu \
	mkdir --parents /shared/log

	setuid ubuntu \
	touch /shared/log/wistla-browser.log

	exec >> /shared/log/wistla-browser.log
	exec 2>> /shared/log/wistla-browser.log

	exec setuid ubuntu \
{% if debug == 'yes' %}
	node-debug \
	--debug-brk=0 \
{% else %}
	stdbuf -oL -eL \
	node \
	--trace_gc \
	--expose_gc \
	--gc_global \
{% endif %}
	server.js

end script

post-stop exec sleep 2
